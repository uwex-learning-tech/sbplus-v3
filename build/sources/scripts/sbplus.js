function getKalturaStatus(e){var t="";switch(e){case-1:t="ERROR";break;case 0:t="QUEUED (queued for conversion)";break;case 1:t="CONVERTING";break;case 2:t="READY";break;case 3:t="DELETED";break;case 4:t="NOT APPLICABLE";break;default:t="UNKNOWN ERROR (check main entry)"}return t}function getEntryKalturaStatus(e){var t="";switch(e){case-2:t="ERROR IMPORTING";break;case-1:t="ERROR CONVERTING";break;case 0:t="IMPORTING";break;case 1:t="PRECONVERT";break;case 2:t="READY";break;case 3:t="DELETED";break;case 4:t="PENDING MODERATION";break;case 5:t="MODERATE";break;case 6:t="BLOCKED";break;default:t="UNKNOWN ERROR (check entry ID)"}return t}function displayWidgetContent(e){$(SBPLUS.widget.content).html(e).addClass("fadeIn").one("webkitAnimationEnd mozAnimationEnd animationend",function(){$(this).removeClass("fadeIn").off()})}function parseTranscript(e){var t='<div class="lt-wrapper">',s=e.replace(/\n/g,"<br>").split("<br>"),a=0;s=cleanArray(SBPLUS.removeEmptyElements(s)),s[0].match(/\d{2}:\d{2}:\d{2}.\d{3}/g)&&s[1].match(/\d{2}:\d{2}:\d{2}.\d{3}/g)&&(s[0]="",s=SBPLUS.removeEmptyElements(s));for(var i=1;i<s.length;i+=2){var r=s[i-1].split(" ");t+='<span class="lt-line" data-start="'+toSeconds(r[0])+'" data-end="'+toSeconds(r[2])+'">'+s[i]+"</span> ",a++,a>=17&&(t+="<br><br>",a=0)}return t+="</div>"}function cleanArray(e){e=SBPLUS.removeEmptyElements(e);var t=e.findIndex(firstCueZero);t===-1&&(t=e.indexOf(e.find(firstCue))),e=e.splice(t);for(var s=0;s<e.length;s++)if(e[s].match(/\d{2}:\d{2}:\d{2}.\d{3}/g)){var a=e[s].split(" ");if(!(a.length>3))continue;e[s]=a.splice(0,3).join(" ")}else void 0!==e[s+1]&&(e[s+1].match(/\d{2}:\d{2}:\d{2}.\d{3}/g)||(e[s]=e[s]+" "+e[s+1],e[s+1]=""));return SBPLUS.removeEmptyElements(e)}function firstCueZero(e){return e.match(/(00:00:00.000)/)}function firstCue(e){return e.match(/\d{2}:\d{2}:\d{2}.\d{3}/g)}function toSeconds(e){var t=e.split(":");return t.length>=3?60*Number(60*t[0])+Number(60*t[1])+Number(t[2]):Number(60*t[0])+Number(t[1])}function questionExists(e){var t=!1;return $.each(quizTracker,function(s){if(quizTracker[s].id===e)return void(t=!0)}),t}function shuffle(e){var t,s,a;for(a=e.length;a;a--)t=Math.floor(Math.random()*a),s=e[a-1],e[a-1]=e[t],e[t]=s}function getCurrentQuizItem(e,t){var s=void 0;return $.each(e,function(a){if(e[a].id===t)return s=a,!1}),s}function MenuBar(e,t){this.$id=$("#"+e),this.$rootItems=this.$id.children("li"),this.$items=this.$id.find(".menu-item").not(".separator"),this.$parents=this.$id.find(".menu-parent"),this.$allItems=this.$parents.add(this.$items),this.$activeItem=null,this.vmenu=t,this.bChildOpen=!1,this.keys={tab:9,enter:13,esc:27,space:32,left:37,up:38,right:39,down:40},this.bindHandlers()}var transcriptInterval=null,Page=function(e){this.title=e.title,this.type=e.type,this.transition=e.transition,this.pageNumber=e.number,"quiz"===e.type?this.quiz=e.quiz:(this.src=e.src,this.notes=e.notes,this.widget=e.widget,this.widgetSegments={},this.imgType=e.imageFormat,e.frames.length&&(this.frames=e.frames,this.cuepoints=[]),this.mediaPlayer=null,this.isKaltura=null,this.isAudio=!1,this.isVideo=!1,this.isYoutube=!1,this.isVimeo=!1,this.isBundle=!1,this.isPlaying=!1,this.captionUrl="",this.transcript=null,this.transcriptLoaded=!1,this.transcriptIntervalStarted=!1,this.hasImage=!1,this.delayStorage=null),this.root=SBPLUS.manifest.sbplus_root_directory,this.kaltura={id:SBPLUS.manifest.sbplus_kaltura.id,flavors:{low:SBPLUS.manifest.sbplus_kaltura.low,normal:SBPLUS.manifest.sbplus_kaltura.normal,high:SBPLUS.manifest.sbplus_kaltura.high}},this.leftCol=SBPLUS.layout.leftCol,this.mediaContent=SBPLUS.layout.mediaContent,this.quizContainer=SBPLUS.layout.quizContainer,this.mediaError=SBPLUS.layout.mediaError};Page.prototype.getPageMedia=function(){var e=this;switch($(SBPLUS.layout.quizContainer).length&&$(SBPLUS.layout.quizContainer).remove(),$(this.mediaError).empty().hide(),$("#mp").length&&videojs("mp").dispose(),SBPLUS.hasStorageItem("sbplus-previously-widget-open",!0)&&("1"===SBPLUS.getStorageItem("sbplus-previously-widget-open",!0)&&SBPLUS.showWidget(),SBPLUS.enableWidget(),SBPLUS.deleteStorageItem("sbplus-previously-widget-open",!0)),clearInterval(transcriptInterval),e.type){case"kaltura":SBPLUS.hasStorageItem("sbplus-kaltura-loaded",!0)===!1?$.getScript(e.root+"/scripts/libs/kaltura/mwembedloader.js",function(){$.getScript(e.root+"/scripts/libs/kaltura/kwidgetgetsources.js",function(){SBPLUS.setStorageItem("sbplus-kaltura-loaded",1,!0),e.loadKalturaVideoData()})}):e.loadKalturaVideoData();break;case"image-audio":e.isAudio=!0,$.get("assets/pages/"+e.src+"."+e.imgType,function(){e.hasImage=!0}).fail(function(){e.showPageError("NO_IMG")}).always(function(){$.get("assets/audio/"+e.src+".vtt",function(t){e.captionUrl=this.url,e.transcript=SBPLUS.stripScript(t)}).always(function(){var t='<video id="mp" class="video-js vjs-default-skin" webkit-playsinline playsinline></video>';$(e.mediaContent).html(t).promise().done(function(){e.renderVideoJS(),e.setWidgets()})})});break;case"image":var t=new Image;t.src="assets/pages/"+e.src+"."+e.imgType,t.alt=e.title,t.className="img_only",$(t).on("load",function(){e.hasImage=!0,$(e.mediaContent).html(t).promise().done(function(){e.setWidgets()})}),$(t).on("error",function(){e.hasImage=!1,e.showPageError("NO_IMG")});break;case"video":$.get("assets/video/"+e.src+".vtt",function(t){e.captionUrl=this.url,e.transcript=SBPLUS.stripScript(t)}).always(function(){var t='<video id="mp" class="video-js vjs-default-skin" crossorigin="anonymous" width="100%" height="100%" webkit-playsinline playsinline></video>';$(e.mediaContent).html(t).promise().done(function(){e.isVideo=!0,e.renderVideoJS(),e.setWidgets()})});break;case"youtube":$(e.mediaContent).html('<video id="mp" class="video-js vjs-default-skin" webkit-playsinline playsinline></video>').promise().done(function(){e.isYoutube=!0,SBPLUS.hasStorageItem("sbplus-vjs-yt-loaded",!0)===!1?$.getScript(SBPLUS.manifest.sbplus_root_directory+"scripts/libs/videojs/plugins/youtube/youtube.js",function(){e.renderVideoJS(),SBPLUS.setStorageItem("sbplus-vjs-yt-loaded",1,!0)}):e.renderVideoJS(),e.setWidgets()});break;case"vimeo":$(e.mediaContent).html('<video id="mp" class="video-js vjs-default-skin" webkit-playsinline playsinline></video>').promise().done(function(){e.isVimeo=!0,SBPLUS.hasStorageItem("sbplus-vjs-vimeo-loaded",!0)===!1?$.getScript(SBPLUS.manifest.sbplus_root_directory+"scripts/libs/videojs/plugins/vimeo/vimeo.js",function(){e.renderVideoJS(),SBPLUS.setStorageItem("sbplus-vjs-vimeo-loaded",1,!0)}):e.renderVideoJS(),e.setWidgets()});break;case"html":$(e.mediaContent).html('<iframe class="html" src="assets/html/'+e.src+'/index.html"></iframe>').promise().done(function(){e.setWidgets()});break;case"bundle":$(e.frames).each(function(){var t=toSeconds($(this).attr("start"));e.cuepoints.push(t)}),$.get("assets/audio/"+e.src+".vtt",function(t){e.captionUrl=this.url,e.transcript=SBPLUS.stripScript(t)}).always(function(){var t='<video id="mp" class="video-js vjs-default-skin" webkit-playsinline playsinline></video>';$(e.mediaContent).html(t).promise().done(function(){e.isBundle=!0,e.renderVideoJS(),e.setWidgets()})});break;case"quiz":$(e.leftCol).append('<div id="sbplus_quiz_wrapper"></div>').promise().done(function(){var t={id:e.pageNumber,context:e.quiz},s=new Quiz(t);s.getQuiz(),$("#sbplus_widget").is(":visible")&&SBPLUS.setStorageItem("sbplus-previously-widget-open",1,!0),SBPLUS.hideWidget(),SBPLUS.disableWidget()});break;default:e.setWidgets()}"image"!==e.type&&"html"!==e.type||$(e.mediaContent).addClass(e.transition).one("webkitAnimationEnd mozAnimationEnd animationend",function(){$(this).removeClass(e.transition),$(this).off()}),window.clearTimeout(e.delayStorage),e.delayStorage=window.setTimeout(function(){var t=SBPLUS.sanitize($(SBPLUS.banner.title).html());SBPLUS.setStorageItem("sbplus-"+t,e.pageNumber[0]+","+e.pageNumber[1])},3e3)},Page.prototype.loadKalturaVideoData=function(){var e=this;e.isKaltura={flavors:{},status:{entry:0,low:0,normal:0,high:0},duration:""},kWidget.getSources({partnerId:e.kaltura.id,entryId:e.src,callback:function(t){var s=t.captionId,a="";e.isKaltura.status.entry=t.status,e.isKaltura.duration=t.duration;for(var i in t.sources){var r=t.sources[i];r.flavorParamsId===e.kaltura.flavors.low&&(e.isKaltura.flavors.low=r.src,e.isKaltura.status.low=r.status),r.flavorParamsId===e.kaltura.flavors.normal&&(e.isKaltura.flavors.normal=r.src,e.isKaltura.status.normal=r.status),r.flavorParamsId===e.kaltura.flavors.high&&(e.isKaltura.flavors.high=r.src,e.isKaltura.status.high=r.status)}e.isKaltura.status.entry>=1&&e.isKaltura.status.entry<=2?2===e.isKaltura.status.low&&2===e.isKaltura.status.normal&&2===e.isKaltura.status.high?(null!==s&&(e.captionUrl="https://www.kaltura.com/api_v3/?service=caption_captionasset&action=servewebvtt&captionAssetId="+s+"&segmentDuration="+e.isKaltura.duration+"&segmentIndex=1"),a='<video id="mp" class="video-js vjs-default-skin" crossorigin="anonymous" width="100%" height="100%" webkit-playsinline playsinline></video>',$(e.mediaContent).html(a).promise().done(function(){e.renderVideoJS(),e.setWidgets()})):e.showPageError("KAL_NOT_READY"):e.showPageError("KAL_ENTRY_NOT_READY")}})},Page.prototype.renderVideoJS=function(){var e=this,t=!0;"0"===SBPLUS.getStorageItem("sbplus-autoplay")&&(t=!1);var s={techOrder:["html5"],controls:!0,autoplay:t,preload:"auto",playbackRates:[.5,1,1.5,2],controlBar:{fullscreenToggle:!1},plugins:{replayButton:{}},manualCleanup:!0};if(SBPLUS.isMobileDevice()&&(s.autoplay=!1),e.isKaltura?s.plugins=Object.assign(s.plugins,{videoJsResolutionSwitcher:{default:720}}):e.isYoutube?(s.techOrder=["youtube"],s.sources=[{type:"video/youtube",src:"https://www.youtube.com/watch?v="+e.src}],s.playbackRates=null,s.plugins=Object.assign(s.plugins,{videoJsResolutionSwitcher:{default:720}})):e.isVimeo&&(s.techOrder=["vimeo"],s.sources=[{type:"video/vimeo",src:"https://vimeo.com/"+e.src}],s.playbackRates=null,s.controls=!1),e.mediaPlayer=videojs("mp",s,function(){var t=this;if(t.manualCleanup=!0,e.isKaltura&&t.updateSrc([{src:e.isKaltura.flavors.low,type:"video/mp4",label:"low",res:360},{src:e.isKaltura.flavors.normal,type:"video/mp4",label:"normal",res:720},{src:e.isKaltura.flavors.high,type:"video/mp4",label:"high",res:1080}]),e.isAudio||e.isBundle){if(e.isAudio&&e.hasImage&&t.poster("assets/pages/"+e.src+"."+e.imgType),e.isBundle){var a=0,i=new Image;t.on("loadedmetadata",function(){a=Math.floor(t.duration())}),t.cuepoints(),t.addCuepoint({namespace:e.src+"-1",start:0,end:e.cuepoints[1],onStart:function(){i.src="assets/pages/"+e.src+"-1."+e.imgType,t.poster(i.src)},onEnd:function(){},params:""}),$.each(e.cuepoints,function(s){var r;r=void 0===e.cuepoints[s+1]?a:e.cuepoints[s+1],t.addCuepoint({namespace:e.src+"-"+(s+2),start:e.cuepoints[1],end:r,onStart:function(){i.src="assets/pages/"+e.src+"-"+(s+2)+"."+e.imgType,$(i).on("error",function(){e.showPageError("NO_IMG")}),t.poster(i.src)}})}),t.on("seeking",function(){t.currentTime()<=e.cuepoints[0]&&t.poster("assets/pages/"+e.src+"-1."+e.imgType)})}t.src({type:"audio/mp3",src:"assets/audio/"+e.src+".mp3"})}e.isVideo&&t.src({type:"video/mp4",src:"assets/video/"+e.src+".mp4"}),e.captionUrl&&t.addRemoteTextTrack({kind:"subtitles",language:"en",label:"English",src:e.captionUrl},!0),t.on(["waiting","pause"],function(){e.isPlaying=!1,"0"===SBPLUS.getStorageItem("sbplus-disable-it")&&(clearInterval(transcriptInterval),e.transcriptIntervalStarted=!1)}),t.on("ended",function(){e.isPlaying=!1,"0"===SBPLUS.getStorageItem("sbplus-disable-it")&&($("#sbplus_interactivetranscript").hasClass("active")&&$(".lt-wrapper .lt-line").removeClass("current"),clearInterval(transcriptInterval),e.transcriptIntervalStarted=!1)}),t.on("playing",function(){e.isPlaying=!0,"0"===SBPLUS.getStorageItem("sbplus-disable-it")&&$("#sbplus_interactivetranscript").hasClass("active")&&e.transcriptIntervalStarted===!1&&e.startInteractiveTranscript()}),null!==s.playbackRates&&e.isYoutube===!1&&e.isVimeo===!1&&(t.on("resolutionchange",function(){t.playbackRate(Number(SBPLUS.getStorageItem("sbplus-playbackrate-temp",!0)))}),SBPLUS.hasStorageItem("sbplus-playbackrate-temp",!0)?t.playbackRate(Number(SBPLUS.getStorageItem("sbplus-playbackrate-temp",!0))):t.playbackRate(Number(SBPLUS.getStorageItem("sbplus-playbackrate"))),t.on("ratechange",function(){SBPLUS.setStorageItem("sbplus-playbackrate-temp",t.playbackRate(),!0)})),SBPLUS.hasStorageItem("sbplus-volume-temp",!0)?t.volume(Number(SBPLUS.getStorageItem("sbplus-volume-temp",!0))):t.volume(Number(SBPLUS.getStorageItem("sbplus-volume"))),t.on("volumechange",function(){SBPLUS.setStorageItem("sbplus-volume-temp",this.volume(),!0)}),e.isYoutube===!1&&e.isVimeo===!1&&(SBPLUS.hasStorageItem("sbplus-subtitle-temp",!0)?"1"===SBPLUS.getStorageItem("sbplus-subtitle-temp",!0)?t.textTracks().tracks_[0].mode="showing":t.textTracks().tracks_[0].mode="disabled":"1"===SBPLUS.getStorageItem("sbplus-subtitle")?t.textTracks().tracks_[0].mode="showing":t.textTracks().tracks_[0].mode="disabled",t.textTracks().addEventListener("change",function(){var e=this.tracks_;$.each(e,function(){"showing"===this.mode?SBPLUS.setStorageItem("sbplus-subtitle-temp",1,!0):SBPLUS.setStorageItem("sbplus-subtitle-temp",0,!0)})}))}),$("#mp_html5_api").length&&$("#mp_html5_api").addClass("animated "+e.transition).one("webkitAnimationEnd mozAnimationEnd animationend",function(){$(this).removeClass("animated "+e.transition),$(this).off()}),$("#mp_Youtube_api").length){var a=$("#mp_Youtube_api").parent();a.addClass("animated "+e.transition).one("webkitAnimationEnd mozAnimationEnd animationend",function(){$(this).removeClass("animated "+e.transition),$(this).off()})}if(SBPLUS.isMobileDevice()){var i=$("video").get(0);makeVideoPlayableInline(i),$(".video-js").removeClass("vjs-using-native-controls"),$(".vjs-loading-spinner").hide()}},Page.prototype.setWidgets=function(){var e=this;if(SBPLUS.clearWidgetSegment(),"quiz"!=this.type){if(SBPLUS.isEmpty(this.notes)||SBPLUS.addSegment("Notes"),"0"===SBPLUS.getStorageItem("sbplus-disable-it")&&((e.isAudio||e.isVideo||e.isBundle)&&(SBPLUS.isEmpty(e.transcript)||SBPLUS.addSegment("Interactive Transcript")),e.isKaltura&&(SBPLUS.isEmpty(e.captionUrl)||SBPLUS.addSegment("Interactive Transcript"))),this.widget.length){var t=$($(this.widget).find("segment"));t.each(function(){var t=$(this).attr("name"),s=SBPLUS.stripScript($(this).text()),a="sbplus_"+SBPLUS.sanitize(t);e.widgetSegments[a]=s,SBPLUS.addSegment(t)})}SBPLUS.selectFirstSegment()}},Page.prototype.getWidgetContent=function(e){var t=this;switch(e){case"sbplus_notes":displayWidgetContent(this.notes);break;case"sbplus_interactivetranscript":"0"===SBPLUS.getStorageItem("sbplus-disable-it")&&(t.isAudio||t.isVideo?(displayWidgetContent(parseTranscript(t.transcript)),t.startInteractiveTranscript()):t.transcriptLoaded===!1?$.get(t.captionUrl,function(e){t.transcriptLoaded=!0,t.transcript=parseTranscript(SBPLUS.stripScript(e)),displayWidgetContent(t.transcript),t.startInteractiveTranscript()}):(displayWidgetContent(t.transcript),t.startInteractiveTranscript()));break;default:displayWidgetContent(t.widgetSegments[e])}},Page.prototype.startInteractiveTranscript=function(){var e=this;if(e.mediaPlayer){var t=$(".lt-wrapper .lt-line");transcriptInterval=setInterval(function(){if(e.isPlaying&&$(SBPLUS.layout.widget).is(":visible")){t.removeClass("current"),t.each(function(){if(e.mediaPlayer.currentTime()>=$(this).data("start")&&e.mediaPlayer.currentTime()<=$(this).data("end"))return void $(this).addClass("current")});var s=$(".lt-wrapper .lt-line.current");if(s.length){var a=$("#sbplus_widget").height(),i=s[0].offsetTop;i>a&&s[0].scrollIntoView(!1)}}},500),e.transcriptIntervalStarted=!0}$(".lt-wrapper .lt-line").on("click",function(t){var s=$(t.currentTarget).data("start");e.mediaPlayer.currentTime(s)})},Page.prototype.showPageError=function(e){var t=this,s="";switch(e){case"NO_IMG":s="<p>The image for this Storybook Page could not be loaded. Please try refreshing your browser. Contact support if you continue to have issues.</p>";break;case"KAL_NOT_READY":s="<p>The video for this Storybook Page is still processing and could not be loaded at the moment. Please try again later. Contact support if you continue to have issues.</p><p><strong>Expected video source</strong>: Kaltura video ID  "+t.src+"<br><strong>Status</strong>:<br>",s+="Low &mdash; "+getKalturaStatus(t.isKaltura.status.low)+"<br>",s+="Normal &mdash; "+getKalturaStatus(t.isKaltura.status.normal)+"<br>",s+="High &mdash; "+getKalturaStatus(t.isKaltura.status.high)+"</p>";break;case"KAL_ENTRY_NOT_READY":s="<p>The video for this Storybook Page is still processing and could not be loaded at the moment. Please try again later. Contact support if you continue to have issues.</p><p><strong>Expected video source</strong>: Kaltura video ID "+t.src+"<br><strong>Status</strong>: ",s+=getEntryKalturaStatus(t.isKaltura.status.entry)+"</p>"}$(t.mediaError).html(s).show()};var quizTracker=[],Quiz=function(e){var t=this,s=$(e.context).html(),a=Number(e.id.join().replace(",","")),i=$(s)[0].nodeName.toLowerCase(),r=$(s).find("question"),n=$(e.context[0])[0].firstElementChild.firstElementChild.textContent.trim(),o="",l="";switch(SBPLUS.isEmpty(r.attr("image"))||(o=SBPLUS.stripScript(r.attr("image").trim())),SBPLUS.isEmpty(r.attr("audio"))||(l=SBPLUS.stripScript(r.attr("audio").trim())),t.quiz={id:a,type:i,question:n,questionImg:o,questionAudio:l,stuAnswer:"",correct:!1},t.quizContainer=SBPLUS.layout.quizContainer,i){case"multiplechoicesingle":var u=$(s).find("choices").find("answer");if(!SBPLUS.isEmpty($(s).find("choices").attr("random"))){var d=SBPLUS.stripScript($(s).find("choices").attr("random").trim());"yes"===d?t.quiz.random=!0:t.quiz.random=!1}t.quiz.answers=[],$.each(u,function(){var e={};e.value=SBPLUS.stripScript($(this).find("value").text().trim()),SBPLUS.isEmpty($(this).attr("image"))||(e.img=SBPLUS.stripScript($(this).attr("image").trim()),e.value=e.img),SBPLUS.isEmpty($(this).attr("audio"))||(e.audio=SBPLUS.stripScript($(this).attr("audio").trim()),e.value=e.audio),SBPLUS.isEmpty($(this).attr("correct"))||(e.correct=SBPLUS.stripScript($(this).attr("correct").trim()));var s=$(this).find("feedback");e.feedback=SBPLUS.stripScript(s.text().trim()),t.quiz.answers.push(e)});break;case"multiplechoicemultiple":var p=$(s).find("choices").find("answer");if(!SBPLUS.isEmpty($(s).find("choices").attr("random"))){var c=SBPLUS.stripScript($(s).find("choices").attr("random").trim());"yes"===c?t.quiz.random=!0:t.quiz.random=!1}t.quiz.answers=[],$.each(p,function(){var e={};e.value=SBPLUS.stripScript($(this).find("value").text().trim()),SBPLUS.isEmpty($(this).attr("image"))||(e.img=SBPLUS.stripScript($(this).attr("image").trim()),e.value=e.img),SBPLUS.isEmpty($(this).attr("audio"))||(e.audio=SBPLUS.stripScript($(this).attr("audio").trim()),e.value=e.audio),SBPLUS.isEmpty($(this).attr("correct"))||(e.correct=SBPLUS.stripScript($(this).attr("correct").trim())),t.quiz.answers.push(e);var a=$(s).find("correctFeedback"),i=$(s).find("incorrectFeedback");t.quiz.correctFeedback=SBPLUS.stripScript(a.text().trim()),t.quiz.incorrectFeedback=SBPLUS.stripScript(i.text().trim())});break;case"shortanswer":var m=$(s).find("feedback");t.quiz.feedback=SBPLUS.stripScript(m.text().trim());break;case"fillintheblank":t.quiz.answer=SBPLUS.stripScript($(s).find("answer").text().trim());var h=$(s).find("correctFeedback"),g=$(s).find("incorrectFeedback");t.quiz.correctFeedback=SBPLUS.stripScript(h.text().trim()),t.quiz.incorrectFeedback=SBPLUS.stripScript(g.text().trim())}questionExists(t.quiz.id)===!1&&quizTracker.push(this.quiz)};Quiz.prototype.getQuiz=function(){var e=this,t=!1;e.qIndex=getCurrentQuizItem(quizTracker,e.quiz.id),Array.isArray(quizTracker[e.qIndex].stuAnswer)?quizTracker[e.qIndex].stuAnswer.length>=1&&(t=!0):SBPLUS.isEmpty(quizTracker[e.qIndex].stuAnswer)||(t=!0),t?e.renderFeeback():e.renderQuiz(),"on"===SBPLUS.xml.settings.mathjax&&MathJax.Hub.Queue(["Typeset",MathJax.Hub])},Quiz.prototype.renderQuiz=function(){var e=this,t="",s="",a='<div class="sbplus_quiz_header"><span class="icon-assessment"></span>';a+=" Self Assessment</div>",SBPLUS.isEmpty(e.quiz.questionImg)||(t='<p><img src="assets/images/'+e.quiz.questionImg+'" /></p>'),SBPLUS.isEmpty(e.quiz.questionAudio)||(s='<p><audio controls><source src="assets/audio/'+e.quiz.questionAudio+'" type="audio/mpeg" /></audio></p>'),a+='<div class="sbplus_quiz_question">'+t+s+e.quiz.question+"</div>",a+='<div class="sbplus_quiz_input"></div>',a+='<button class="sbplus_quiz_submit_btn">Submit</button>',$(e.quizContainer).html(a).promise().done(function(){switch(e.quiz.type){case"multiplechoicesingle":var t="";e.quiz.random&&shuffle(e.quiz.answers),$.each(e.quiz.answers,function(s){var a=SBPLUS.sanitize(e.quiz.answers[s].value);return SBPLUS.isEmpty(e.quiz.answers[s].img)?SBPLUS.isEmpty(e.quiz.answers[s].audio)?void(t+='<label for="'+a+'"><input type="radio" id="'+a+'" name="ms" value="'+s+'" /> '+e.quiz.answers[s].value+"</label>"):(a=SBPLUS.sanitize(e.quiz.answers[s].audio),t+='<label class="au_val" for="'+a+'"><input type="radio" id="'+a+'" name="ms" value="'+s+'" /> <audio controls><source src="assets/audio/'+e.quiz.answers[s].audio+'" type="audio/mpeg"/></audio></label>',!0):(a=SBPLUS.sanitize(e.quiz.answers[s].img),t+='<label class="img_val" for="'+a+'"><input type="radio" id="'+a+'" name="ms" value="'+s+'" /><img src="assets/images/'+e.quiz.answers[s].img+'"/ ></label>',!0)}),$(".sbplus_quiz_input").html(t);break;case"multiplechoicemultiple":var s="";e.quiz.random&&shuffle(e.quiz.answers),$.each(e.quiz.answers,function(t){var a=SBPLUS.sanitize(e.quiz.answers[t].value);return SBPLUS.isEmpty(e.quiz.answers[t].img)?SBPLUS.isEmpty(e.quiz.answers[t].audio)?void(s+='<label for="'+a+'"><input type="checkbox" id="'+a+'" name="mm" value="'+t+'" /> '+e.quiz.answers[t].value+"</label>"):(a=SBPLUS.sanitize(e.quiz.answers[t].audio),s+='<label class="au_val" for="'+a+'"><input type="checkbox" id="'+a+'" name="mm" value="'+t+'" /> <audio controls><source src="assets/audio/'+e.quiz.answers[t].audio+'" type="audio/mpeg"/></audio></label>',!0):(a=SBPLUS.sanitize(e.quiz.answers[t].img),s+='<label class="img_val" for="'+a+'"><input type="checkbox" id="'+a+'" name="mm" value="'+t+'" /><img src="assets/images/'+e.quiz.answers[t].img+'" /></label>',!0)}),$(".sbplus_quiz_input").html(s);break;case"shortanswer":$(".sbplus_quiz_input").html("<textarea></textarea>");break;case"fillintheblank":$(".sbplus_quiz_input").html('<input type="text" />')}}),$("button.sbplus_quiz_submit_btn").on("click",function(){switch(e.quiz.type){case"multiplechoicesingle":quizTracker[e.qIndex].stuAnswer=$('input[type="radio"]:checked').val(),SBPLUS.isEmpty(quizTracker[e.qIndex].stuAnswer)||$.each(e.quiz.answers,function(){if(void 0!==this.correct){var t=SBPLUS.sanitize(e.quiz.answers[Number(e.quiz.stuAnswer)].value);return t===SBPLUS.sanitize(this.value)?quizTracker[e.qIndex].correct=!0:quizTracker[e.qIndex].correct=!1,!0}});break;case"multiplechoicemultiple":var t=$('input:checkbox[name="mm"]'),s=[];if(quizTracker[e.qIndex].stuAnswer=[],t.each(function(){this.checked&&quizTracker[e.qIndex].stuAnswer.push(Number($(this).val()))}),$.each(e.quiz.answers,function(){void 0!==this.correct&&s.push(SBPLUS.sanitize(this.value))}),quizTracker[e.qIndex].stuAnswer.length<s.length||quizTracker[e.qIndex].stuAnswer.length>s.length)quizTracker[e.qIndex].correct=!1;else if(quizTracker[e.qIndex].stuAnswer.length===s.length)for(var a=0;a<quizTracker[e.qIndex].stuAnswer.length;a++){var i=Number(quizTracker[e.qIndex].stuAnswer[a]),r=SBPLUS.sanitize(quizTracker[e.qIndex].answers[i].value);if(!($.inArray(r,s)>=0)){quizTracker[e.qIndex].correct=!1;break}quizTracker[e.qIndex].correct=!0}break;case"shortanswer":quizTracker[e.qIndex].stuAnswer=$(".sbplus_quiz_input textarea").val();break;case"fillintheblank":quizTracker[e.qIndex].stuAnswer=$("input").val(),quizTracker[e.qIndex].stuAnswer!==e.quiz.answer?quizTracker[e.qIndex].correct=!1:quizTracker[e.qIndex].correct=!0}var n=!1;Array.isArray(quizTracker[e.qIndex].stuAnswer)?quizTracker[e.qIndex].stuAnswer.length>=1&&(n=!0):SBPLUS.isEmpty(quizTracker[e.qIndex].stuAnswer)||(n=!0),n===!1?($(".sbplus_quiz_header").after('<div class="quiz_error"><span class="icon-warning"></span> Please answer the question before submitting.</div>'),setTimeout(function(){$(".quiz_error").fadeOut(1e3,function(){$(this).remove()})},4e3)):(e.renderFeeback(),"on"===SBPLUS.xml.settings.mathjax&&MathJax.Hub.Queue(["Typeset",MathJax.Hub]))})},Quiz.prototype.renderFeeback=function(){var e=this,t="",s="",a='<div class="sbplus_quiz_header"><span class="icon-assessment"></span>';switch(a+=" Self Assessment Feedback</div>","shortanswer"!==e.quiz.type&&(a+=quizTracker[e.qIndex].correct?'<div class="quiz_correct"><span class="icon-check"></span> Correct!</div>':'<div class="quiz_incorrect"><span class="icon-warning"></span> Incorrect!</div>'),SBPLUS.isEmpty(e.quiz.questionImg)||(t='<p><img src="assets/images/'+e.quiz.questionImg+'" /></p>'),SBPLUS.isEmpty(e.quiz.questionAudio)||(s='<p><audio controls><source src="assets/audio/'+e.quiz.questionAudio+'" type="audio/mpeg" /></audio></p>'),a+='<div class="sbplus_quiz_question">'+t+s+e.quiz.question+"</div>",a+='<div class="sbplus_quiz_result">',e.quiz.type){case"shortanswer":a+="<p><strong>Your answer:</strong><br>"+quizTracker[e.qIndex].stuAnswer+"</p>",SBPLUS.isEmpty(e.quiz.feedback)||(a+="<p><strong>Feedback:</strong><br>"+e.quiz.feedback+"</p>");break;case"fillintheblank":a+="<p><strong>Your answer:</strong><br>"+quizTracker[e.qIndex].stuAnswer+"</p>",a+="<p><strong>Correct answer:</strong><br>"+e.quiz.answer+"</p>",quizTracker[e.qIndex].correct?SBPLUS.isEmpty(e.quiz.correctFeedback)||(a+="<p><strong>Feedback:</strong><br>"+e.quiz.correctFeedback+"</p>"):SBPLUS.isEmpty(e.quiz.incorrectFeedback)||(a+="<p><strong>Feedback:</strong><br>"+e.quiz.incorrectFeedback+"</p>");break;case"multiplechoicesingle":var i=Number(quizTracker[e.qIndex].stuAnswer),r=quizTracker[e.qIndex].answers[i],n=r.value,o=r.feedback,l=r.img,u=r.audio,d="text";switch(SBPLUS.isEmpty(l)||(d="img"),SBPLUS.isEmpty(u)||(d="audio"),d){case"img":a+='<p><strong>Your answer:</strong><br><img src="assets/images/'+r.img+'" /></p>';break;case"audio":a+='<p><strong>Your answer:</strong><br><audio controls><source src="assets/audio/'+u+'" type="audio/mpeg"/></audio></p>';break;case"text":a+="<p><strong>Your answer:</strong><br>"+n+"</p>"}$.each(e.quiz.answers,function(t){if(void 0!==e.quiz.answers[t].correct){var s=e.quiz.answers[t].value;switch(d){case"img":s='<img src="assets/images/'+e.quiz.answers[t].value+'" />';break;case"audio":s='<audio controls><source src="assets/audio/'+e.quiz.answers[t].value+'" type="audio/mpeg"/></audio>'}return a+="<p><strong>Correct answer:</strong><br>"+s+"</p>",!1}}),SBPLUS.isEmpty(o)||(a+="<p><strong>Feedback:</strong><br>"+o+"</p>");break;case"multiplechoicemultiple":var p=quizTracker[e.qIndex].stuAnswer;a+="<p><strong>Your answer:</strong><br>",$.each(p,function(t){var s=Number(p[t]),i="text";switch(SBPLUS.isEmpty(e.quiz.answers[s].img)||(i="img"),SBPLUS.isEmpty(e.quiz.answers[s].audio)||(i="audio"),i){case"img":a+='<img src="assets/images/'+e.quiz.answers[s].value+'" /><br>';break;case"audio":a+='<audio controls><source src="assets/audio/'+e.quiz.answers[s].value+'" type="audio/mpeg"/></audio><br>';break;case"text":a+=e.quiz.answers[s].value+"<br>"}}),a+="</p><p><strong>Correct answer:</strong><br>",$.each(e.quiz.answers,function(){if(void 0!==this.correct){var e="text";switch(SBPLUS.isEmpty(this.img)||(e="img"),SBPLUS.isEmpty(this.audio)||(e="audio"),e){case"img":a+='<img src="assets/images/'+this.value+'" /><br>';break;case"audio":a+='<audio controls><source src="assets/audio/'+this.value+'" type="audio/mpeg"/></audio><br>';break;case"text":a+=this.value+"<br>"}}}),a+="</p>",quizTracker[e.qIndex].correct?SBPLUS.isEmpty(e.quiz.correctFeedback)||(a+="<p><strong>Feedback:</strong><br>"+e.quiz.correctFeedback+"</p>"):SBPLUS.isEmpty(e.quiz.incorrectFeedback)||(a+="<p><strong>Feedback:</strong><br>"+e.quiz.incorrectFeedback+"</p>")}a+="</div>",$(e.quizContainer).html(a)},MenuBar.prototype.bindHandlers=function(){var e=this;this.$items.on("mouseenter",function(){return $(this).addClass("menu-hover"),!0}),this.$items.on("mouseout",function(){return $(this).removeClass("menu-hover"),!0}),this.$allItems.on("click",function(){return e.handleClick($(this))}),this.$allItems.on("keydown",function(t){return e.handleKeydown($(this),t)}),this.$allItems.on("keypress",function(t){return e.handleKeypress($(this),t)}),this.$allItems.on("focus",function(t){return e.handleFocus($(this),t)}),this.$allItems.on("blur",function(t){return e.handleBlur($(this),t)}),$(document).on("click",function(t){return e.handleDocumentClick(t)})},MenuBar.prototype.handleMouseEnter=function(e){return e.addClass("menu-hover").attr("aria-expanded","true"),"true"===e.attr("aria-haspopup")&&e.children("ul").attr({"aria-hidden":"false","aria-expanded":"true"}),!0},MenuBar.prototype.handleMouseOut=function(e){return e.removeClass("menu-hover").attr("aria-expanded","false"),!0},MenuBar.prototype.handleMouseLeave=function(e){var t=e.find(".menu-focus");return e.removeClass("menu-hover").attr("aria-expanded","false"),t.length>0&&(this.bChildOpen=!1,t.removeClass("menu-focus"),this.$activeItem=e,e.focus()),e.children("ul").attr({"aria-hidden":"true","aria-expanded":"false"}),!0},MenuBar.prototype.handleClick=function(e){var t=e.parent();if(t.is(".root-level")){var s=e.children("ul").first();"false"===s.attr("aria-hidden")?(e.attr("aria-expanded","false"),s.attr({"aria-hidden":"true","aria-expanded":"false"})):(e.attr("aria-expanded","true"),s.attr({"aria-hidden":"false","aria-expanded":"true"}))}else this.$allItems.removeClass("menu-hover menu-focus"),e.attr("aria-expanded","false"),this.$id.find("ul").not(".root-level").attr({"aria-hidden":"true","aria-expanded":"false"})},MenuBar.prototype.handleFocus=function(e){if(null===this.$activeItem)this.$activeItem=e;else if(e[0]!==this.$activeItem[0])return!0;var t=this.$activeItem.parentsUntil("div").filter("li");if(this.$allItems.removeClass("menu-focus"),this.$activeItem.addClass("menu-focus"),t.addClass("menu-focus"),this.vmenu===!0)if(this.bChildOpen===!0){var s=e.parent();s.is(".root-level")&&"true"===e.attr("aria-haspopup")&&(e.attr("aria-expanded","true"),e.children("ul").attr({"aria-hidden":"false","aria-expanded":"true"}))}else this.vmenu=!1;return!0},MenuBar.prototype.handleBlur=function(e){return e.removeClass("menu-focus"),!0},MenuBar.prototype.handleKeydown=function(e,t){if(t.altKey||t.ctrlKey)return!0;var s=e.parent();switch(t.keyCode){case this.keys.tab:e.attr("aria-expanded","false"),this.$id.find("ul").attr({"aria-hidden":"true","aria-expanded":"false"}),this.$allItems.removeClass("menu-focus"),this.$activeItem=null,this.bChildOpen=!1;break;case this.keys.esc:return e.attr("aria-expanded","false"),s.is(".root-level")?e.children("ul").first().attr({"aria-hidden":"true","aria-expanded":"false"}):(this.$activeItem=s.parent(),this.bChildOpen=!1,this.$activeItem.focus(),s.attr({"aria-hidden":"true","aria-expanded":"false"})),t.stopPropagation(),!1;case this.keys.enter:case this.keys.space:var a=e.parent();if(a.is(".root-level"))e.children("ul").first().attr({"aria-hidden":"false","aria-expanded":"true"});else{this.$allItems.removeClass("menu-hover menu-focus"),this.$id.find("ul").not(".root-level").attr({"aria-hidden":"true","aria-expanded":"false"});var i=this.$activeItem.find("a").attr("id");document.getElementById(i).click(),this.$activeItem=null}return t.stopPropagation(),!1;case this.keys.left:return this.vmenu===!0&&s.is(".root-level")?this.$activeItem=this.moveUp(e):this.$activeItem=this.moveToPrevious(e),this.$activeItem.focus(),t.stopPropagation(),!1;case this.keys.right:return this.vmenu===!0&&s.is(".root-level")?this.$activeItem=this.moveDown(e):this.$activeItem=this.moveToNext(e),
this.$activeItem.focus(),t.stopPropagation(),!1;case this.keys.up:return this.vmenu===!0&&s.is(".root-level")?this.$activeItem=this.moveToPrevious(e):this.$activeItem=this.moveUp(e),this.$activeItem.focus(),t.stopPropagation(),!1;case this.keys.down:return this.vmenu===!0&&s.is(".root-level")?this.$activeItem=this.moveToNext(e):this.$activeItem=this.moveDown(e),this.$activeItem.focus(),t.stopPropagation(),!1}return!0},MenuBar.prototype.moveToNext=function(e){var t=e.parent(),s=t.children("li"),a=s.length,i=s.index(e),r=null,n=null;if(t.is(".root-level"))r=i<a-1?e.next():s.first(),"true"===e.attr("aria-haspopup")&&(n=e.children("ul").first(),"false"===n.attr("aria-hidden")&&(e.attr("aria-expanded","false"),n.attr({"aria-hidden":"true","aria-expanded":"false"}),this.bChildOpen=!0)),e.removeClass("menu-focus"),"true"===r.attr("aria-haspopup")&&this.bChildOpen===!0&&(n=r.children("ul").first(),e.attr("aria-expanded","true"),n.attr({"aria-hidden":"false","aria-expanded":"true"}));else if("true"===e.attr("aria-haspopup"))n=e.children("ul").first(),r=n.children("li").first(),e.attr("aria-expanded","true"),n.attr({"aria-hidden":"false","aria-expanded":"true"});else{if(this.vmenu===!0)return e;var o=null,l=null;o=e.parentsUntil("div").filter("ul").not(".root-level"),e.attr("aria-expanded","false"),o.attr({"aria-hidden":"true","aria-expanded":"false"}),o.find("li").removeClass("menu-focus"),o.last().parent().removeClass("menu-focus"),l=o.last().parent(),i=this.$rootItems.index(l),r=i<this.$rootItems.length-1?l.next():this.$rootItems.first(),r.addClass("menu-focus"),"true"===r.attr("aria-haspopup")&&(n=r.children("ul").first(),r=n.children("li").first(),e.attr("aria-expanded","true"),n.attr({"aria-hidden":"false","aria-expanded":"true"}),this.bChildOpen=!0)}return r},MenuBar.prototype.moveToPrevious=function(e){var t=e.parent(),s=t.children("li"),a=s.index(e),i=null,r=null;if(t.is(".root-level"))i=a>0?e.prev():s.last(),"true"===e.attr("aria-haspopup")&&(r=e.children("ul").first(),"false"===r.attr("aria-hidden")&&(e.attr("aria-expanded","false"),r.attr({"aria-hidden":"true","aria-expanded":"false"}),this.bChildOpen=!0)),e.removeClass("menu-focus"),"true"===i.attr("aria-haspopup")&&this.bChildOpen===!0&&(r=i.children("ul").first(),e.attr("aria-expanded","true"),r.attr({"aria-hidden":"false","aria-expanded":"true"}));else{var n=t.parent(),o=n.parent();this.vmenu!==!0&&o.is(".root-level")?(e.attr("aria-expanded","false"),t.attr({"aria-hidden":"true","aria-expanded":"false"}),e.removeClass("menu-focus"),n.removeClass("menu-focus"),a=this.$rootItems.index(n),i=a>0?n.prev():this.$rootItems.last(),i.addClass("menu-focus"),"true"===i.attr("aria-haspopup")&&(r=i.children("ul").first(),e.attr("aria-expanded","true"),r.attr({"aria-hidden":"false","aria-expanded":"true"}),this.bChildOpen=!0,i=r.children("li").first())):(i=t.parent(),e.attr("aria-expanded","false"),t.attr({"aria-hidden":"true","aria-expanded":"false"}),e.removeClass("menu-focus"),this.vmenu===!0&&(this.bChildOpen=!1))}return i},MenuBar.prototype.moveDown=function(e,t){var s=e.parent(),a=s.children("li").not(".separator"),i=a.length,r=a.index(e),n=null,o=null;if(s.is(".root-level"))return"true"!==e.attr("aria-haspopup")?e:(o=e.children("ul").first(),n=o.children("li").first(),$(o.parent()).attr("aria-expanded","true"),e.attr("aria-expanded","true"),o.attr({"aria-hidden":"false","aria-expanded":"true"}),n);if(t){var l=!1,u=r+1;for(u===i&&(u=0);u!==r;){var d=a.eq(u).html().charAt(0);if(d.toLowerCase()===t){l=!0;break}u+=1,u===i&&(u=0)}return l===!0?(n=a.eq(u),e.removeClass("menu-focus"),n):e}return n=r<i-1?a.eq(r+1):a.first(),e.removeClass("menu-focus"),n},MenuBar.prototype.moveUp=function(e){var t=e.parent(),s=t.children("li").not(".separator"),a=s.index(e),i=null;return t.is(".root-level")?e:(i=a>0?s.eq(a-1):s.last(),e.removeClass("menu-focus"),i)},MenuBar.prototype.handleKeypress=function(e,t){if(t.altKey||t.ctrlKey||t.shiftKey)return!0;switch(t.keyCode){case this.keys.tab:return!0;case this.keys.esc:case this.keys.up:case this.keys.down:case this.keys.left:case this.keys.right:return t.stopPropagation(),!1;default:var s=String.fromCharCode(t.which);return this.$activeItem=this.moveDown(e,s),this.$activeItem.focus(),t.stopPropagation(),!1}},MenuBar.prototype.handleDocumentClick=function(){return this.$allItems.removeClass("menu-focus"),this.$activeItem=null,!0};var SBPLUS=SBPLUS||{layout:null,splash:null,banner:null,tableOfContents:null,totalPages:0,widget:null,button:null,menu:null,manifest:null,xml:null,splashScreenRendered:!1,beforeXMLLoadingDone:!1,presentationStarted:!1,downloads:{},settings:null,currentPage:null,hasError:!1,isResuming:!1,clickCount:0,randomNum:Math.floor(10*Math.random()+1),go:function(){if(null!==this.manifest)return"Storybook Plus is already in ready state.";var e=this;this.layout={isMobile:!1,html:"html",wrapper:".sbplus_wrapper",sbplus:"#sbplus",errorScreen:"#sbplus_error_screen",widget:"#sbplus_widget",media:"#sbplus_media_wrapper",mediaContent:"#sbplus_media_wrapper .sbplus_media_content",mediaError:"#sbplus_media_wrapper .sbplus_media_error",leftCol:"#sbplus_left_col",sidebar:"#sbplus_right_col",pageStatus:"#sbplus_page_status",quizContainer:"#sbplus_quiz_wrapper",dwnldMenu:null},this.banner={title:"#sbplus_lession_title",author:"#sbplus_author_name"},this.splash={screen:"#sbplus_splash_screen",background:"#sb_splash_bg",title:"#sbplus_presentation_info .sb_title",subtitle:"#sbplus_presentation_info .sb_subtitle",author:"#sbplus_presentation_info .sb_author",duration:"#sbplus_presentation_info .sb_duration",downloadBar:"#sbplus_presentation_info .sb_downloads"},this.tableOfContents={container:"#sbplus_table_of_contents_wrapper",header:".section .header",page:".section .list .item"},this.widget={bg:"#sbplus_widget.noSegments",bar:"#sbplus_widget .widget_controls_bar",segment:"#sbplus_widget .widget_controls_bar .tab_segment",segments:[],content:"#sbplus_widget .segment_content"},this.button={start:"#sbplus_start_btn",resume:"#sbplus_resume_btn",downloadWrapper:"#sbplus_download_btn_wrapper",download:"#sbplus_download_btn",downloadMenu:"#sbplus_download_btn .menu-parent .downloadFiles",widget:"#sbplus_widget_btn",sidebar:"#sbplus_sidebar_btn",author:"#sbplus_author_name",menu:"#sbplus_menu_btn",next:"#sbplus_next_btn",prev:"#sbplus_previous_btn"},this.menu={menuPanel:"#sbplus_menu_items_wrapper",menuBar:"#sbplus_sub_bar",menuList:"#sbplus_menu_items_wrapper .list",menuItem:"#sbplus_menu_items_wrapper .menu.item",menuContentWrapper:"#menu_item_content",menuContent:"#menu_item_content .content"},$.getJSON(this.getManifestUrl(),function(t){e.setStorageItem("sbplus-manifest-loaded",1,!0),e.manifest=t,e.loadTemplate()}).fail(function(){var t='<div class="error">';t+="<p><strong>Storybook Plus Error:</strong> ",t+="failed to load the manifest file.<br>",t+="Expecting: <code>"+this.url+"</code></p>",t+="</div>",$(e.layout.wrapper).html(t)}),$(window).on("beforeunload",this.removeAllSessionStorage.bind(this))},loadTemplate:function(){if(1!==Number(this.getStorageItem("sbplus-manifest-loaded",!0))||this.hasStorageItem("sbplus-template-loaded",!0)!==!1)return"Storybook Plus template already loaded.";var e=this,t=this.manifest.sbplus_root_directory;t+="scripts/templates/sbplus.tpl",$.get(t,function(t){return e.setStorageItem("sbplus-template-loaded",1,!0),$(e.layout.wrapper).html(t),e.beforeXMLLoading(),0===e.checkForSupport()?(e.hasError=!0,e.showErrorScreen("support"),!1):(e.loadXML(),void $(window).on("resize",e.resize.bind(e)))}).fail(function(){var t='<div class="error">';t+="<p><strong>Storybook Plus Error:</strong> ",t+="failed to load template.<br>",t+="Expecting: <code>"+this.url+"</code></p>",t+="</div>",$(e.layout.wrapper).html(t)})},beforeXMLLoading:function(){if(1===Number(this.getStorageItem("sbplus-manifest-loaded",!0))&&1===Number(this.getStorageItem("sbplus-template-loaded",!0))&&this.beforeXMLLoadingDone===!1){this.beforeXMLLoadingDone=!0,this.resize(),this.setURLOptions();var e=$(this.tableOfContents.header);1===e.length&&e.hide().off("click"),this.setManifestOptions()}},loadXML:function(){if(this.beforeXMLLoadingDone!==!0||this.hasStorageItem("sbplus-xml-loaded",!0)!==!1)return"XML already loaded.";var e=this,t="assets/sbplus.xml";$.get(t,function(t){e.setStorageItem("sbplus-xml-loaded",1,!0),e.parseXMLData(t)}).fail(function(t,s){e.hasError=!0,"parsererror"===s?e.showErrorScreen("parser"):e.showErrorScreen("xml")})},parseXMLData:function(e){if(1!==Number(this.getStorageItem("sbplus-xml-loaded",!0))||this.hasStorageItem("sbplus-xml-parsed",!0)!==!1)return"XML already parsed.";var t=this,s=$(e),a=s.find("storybook"),i=s.find("setup"),r=a.attr("accent").trim(),n=a.attr("pageImgFormat").toLowerCase().trim(),o="svg",l=a.attr("analytics").toLowerCase().trim(),u=a.attr("mathjax").toLowerCase().trim(),d=a.attr("xmlVersion"),p="",c=i.attr("course").toLowerCase().trim(),m=this.stripScript(i.find("title").text().trim()),h=this.stripScript(i.find("subtitle").text().trim()),g=i.find("length").text().trim(),b=i.find("author"),f=this.stripScript(i.find("generalInfo").text().trim()),v=s.find("section"),S=a.attr("splashImgFormat"),_=i.attr("program");S&&(SBPLUS.isEmpty(S)||(o=a.attr("splashImgFormat").toLowerCase().trim())),_&&(p=i.attr("program").toLowerCase().trim()),this.isEmpty(r)&&(r=this.manifest.sbplus_default_accent),this.isEmpty(n)&&(n="jpg"),"on"!==l&&(l="off"),"on"!==u&&(u="off"),this.xml={settings:{accent:r,imgType:n,splashImgType:o,analytics:l,mathjax:u,version:d},setup:{program:p,course:c,title:m,subtitle:h,authorPhoto:"",duration:g,generalInfo:f},sections:v},"on"===this.xml.settings.analytics&&(!function(e,t,s,a,i,r,n){e.GoogleAnalyticsObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,r=t.createElement(s),n=t.getElementsByTagName(s)[0],r.async=1,r.src=a,n.parentNode.insertBefore(r,n)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create",t.manifest.sbplus_google_tracking_id,"auto"),ga("send","pageview"),ga("send","event"));var w=this.sanitize(b.attr("name").trim()),y=this.manifest.sbplus_author_directory+w+".json";$.ajax({crossDomain:!0,type:"GET",dataType:"jsonp",jsonpCallback:"author",url:y}).done(function(e){t.xml.setup.author=e.name,t.xml.setup.profile=t.stripScript(e.profile)}).fail(function(){t.xml.setup.author=b.attr("name").trim(),t.xml.setup.profile=t.stripScript(b.text().trim())}).always(function(){t.setStorageItem("sbplus-xml-parsed",1,!0),t.renderSplashscreen()})},renderSplashscreen:function(){var e=this;if(1!==Number(this.getStorageItem("sbplus-xml-parsed",!0))||this.splashScreenRendered!==!1)return"Splash screen already rendered.";this.hasStorageItem("sbplus-hide-widget")===!1&&this.setStorageItem("sbplus-hide-widget",0),this.hasStorageItem("sbplus-hide-sidebar")===!1&&this.setStorageItem("sbplus-hide-sidebar",0),this.hasStorageItem("sbplus-disable-it")===!1&&this.setStorageItem("sbplus-disable-it",1),this.hasStorageItem("sbplus-autoplay")===!1&&this.setStorageItem("sbplus-autoplay",1),this.hasStorageItem("sbplus-volume")===!1&&this.setStorageItem("sbplus-volume",.8),this.hasStorageItem("sbplus-playbackrate")===!1&&this.setStorageItem("sbplus-playbackrate",1),this.hasStorageItem("sbplus-subtitle")===!1&&this.setStorageItem("sbplus-subtitle",0),$(this.splash.title).html(this.xml.setup.title),$(this.splash.subtitle).html(this.xml.setup.subtitle),$(this.splash.author).html(this.xml.setup.author),$(this.splash.duration).html(this.xml.setup.duration),$.ajax({url:"assets/splash."+e.xml.settings.splashImgType,type:"head"}).done(function(){e.setSplashImage(this.url)}).fail(function(){var t=e.xml.setup.program,s=e.xml.setup.course;if(e.isEmpty(t)&&(t=SBPLUS.getProgramDirectory()),e.isEmpty(s)?(s=SBPLUS.getCourseDirectory(),e.isEmpty(s)?s="default."+e.xml.settings.splashImgType:s+="."+e.xml.settings.splashImgType):s+="."+e.xml.settings.splashImgType,!e.isEmpty(t)&&!e.isEmpty(s)){var a=e.manifest.sbplus_splash_directory+t+"/"+s;$.ajax({url:a,type:"HEAD"}).done(function(){e.setSplashImage(this.url)}).fail(function(){a=e.manifest.sbplus_splash_directory+t+"/default."+e.xml.settings.splashImgType,$.ajax({url:a,type:"HEAD"}).done(function(){e.setSplashImage(this.url)})})}}),$(this.button.start).on("click",this.startPresentation.bind(this)),this.hasStorageItem("sbplus-"+this.sanitize(this.xml.setup.title))?$(this.button.resume).on("click",this.resumePresentation.bind(this)):$(this.button.resume).hide();var t=SBPLUS.getCourseDirectory();if(e.isEmpty(t)&&(t="default"),$.ajax({url:t+".pdf",type:"HEAD"}).done(function(){e.downloads.transcript=this.url,$(e.splash.downloadBar).append('<a href="'+e.downloads.transcript+'" download><span class="icon-download"></span> Transcript</a>')}),$.ajax({url:t+".mp4",type:"HEAD"}).done(function(){e.downloads.video=this.url,$(e.splash.downloadBar).append('<a href="'+e.downloads.video+'" download><span class="icon-download"></span> Video</a>')}),$.ajax({url:t+".mp3",type:"HEAD"}).done(function(){e.downloads.audio=this.url,$(e.splash.downloadBar).append('<a href="'+e.downloads.audio+'" download><span class="icon-download"></span> Audio</a>')}),$.ajax({url:t+".zip",type:"HEAD"}).done(function(){e.downloads.supplement=this.url,$(e.splash.downloadBar).append('<a href="'+e.downloads.supplement+'" download><span class="icon-download"></span> Supplement</a>')}),this.xml.settings.accent!==this.manifest.sbplus_default_accent){var s=this.colorLum(this.xml.settings.accent,.2),a=this.colorContrast(this.xml.settings.accent),i=".sbplus_wrapper button:hover{color:"+this.xml.settings.accent+"}.sbplus_wrapper #sbplus #sbplus_splash_screen #sbplus_presentation_info .sb_cta button{color:"+a+";background-color:"+this.xml.settings.accent+"}.sbplus_wrapper #sbplus #sbplus_splash_screen #sbplus_presentation_info .sb_cta button:hover{background-color:"+s+"}.sbplus_wrapper #sbplus #sbplus_content_wrapper #sbplus_right_col .list .item:hover{color:"+a+";background-color:"+s+"}.sbplus_wrapper #sbplus #sbplus_content_wrapper #sbplus_right_col .list .sb_selected{color:"+a+";background-color:"+this.xml.settings.accent+"}.sbplus_wrapper #sbplus #sbplus_content_wrapper #sbplus_right_col #sbplus_table_of_contents_wrapper .section .current{border-left-color:"+this.xml.settings.accent+"}.sbplus_wrapper #sbplus #sbplus_control_bar #sbplus_right_controls #sbplus_download_btn_wrapper #sbplus_download_btn .menu-parent .menu .menu-item:hover,.sbplus_wrapper #sbplus #sbplus_control_bar #sbplus_right_controls #sbplus_download_btn_wrapper .root-level .menu-parent .menu .menu-item:hover{background-color:"+this.xml.settings.accent+"}.sbplus_wrapper #sbplus #sbplus_control_bar #sbplus_right_controls #sbplus_download_btn_wrapper #sbplus_download_btn .menu-parent .menu .menu-item:hover a,.sbplus_wrapper #sbplus #sbplus_control_bar #sbplus_right_controls #sbplus_download_btn_wrapper .root-level .menu-parent .menu .menu-item:hover a{color:"+a+"}.sbplus_wrapper #sbplus #sbplus_control_bar #sbplus_right_controls #sbplus_download_btn_wrapper #sbplus_download_btn .menu-parent .menu .menu-item:focus,.sbplus_wrapper #sbplus #sbplus_control_bar #sbplus_right_controls #sbplus_download_btn_wrapper .root-level .menu-parent .menu .menu-item:focus{background-color:"+this.xml.settings.accent+"}.sbplus_wrapper #sbplus #sbplus_control_bar #sbplus_right_controls #sbplus_download_btn_wrapper #sbplus_download_btn .menu-parent .menu .menu-item:focus a,.sbplus_wrapper #sbplus #sbplus_control_bar #sbplus_right_controls #sbplus_download_btn_wrapper .root-level .menu-parent .menu .menu-item:focus a{color:"+a+"}.sbplus_wrapper #sbplus #sbplus_control_bar #sbplus_right_controls #sbplus_download_btn_wrapper #sbplus_download_btn .menu-parent:hover,.sbplus_wrapper #sbplus #sbplus_control_bar #sbplus_right_controls #sbplus_download_btn_wrapper .root-level .menu-parent:hover{color:"+this.xml.settings.accent+"}";$("head").append('<style type="text/css">'+i+"</style>")}"on"===this.xml.settings.mathjax&&$.getScript("https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML",function(){MathJax.Hub.Config({"HTML-CSS":{matchFontHeight:!0}})}),this.isMobileDevice()&&$.getScript(this.manifest.sbplus_root_directory+"scripts/libs/iphone-inline-video.browser.js"),this.splashScreenRendered=!0},setSplashImage:function(e){e&&$(this.splash.background).css("background-image","url("+e+")")},renderPresentation:function(){var e=this;if("1"===this.getStorageItem("sbplus-hide-widget")&&this.hideWidget(),"1"===this.getStorageItem("sbplus-hide-sidebar")&&this.hideSidebar(),$(this.banner.title).html(this.xml.setup.title),$(this.banner.author).html(this.xml.setup.author),$(this.xml.sections).each(function(t){var s=$(this).attr("title"),a=$(this).find("page"),i='<div class="section">';i+='<div class="header">',i+='<div class="title">',i+=s+"</div>",i+='<div class="icon"><span class="icon-collapse"></span></div></div>',i+='<ul class="list">',e.isEmpty(s)&&(s="Section "+(t+1)),$.each(a,function(s){++e.totalPages,i+='<li class="item" data-count="',i+=e.totalPages+'" data-page="'+t+","+s+'">',i+="quiz"===$(this).attr("type")?'<span class="icon-assessment"></span>':'<span class="numbering">'+e.totalPages+".</span> ",i+=$(this).attr("title")+"</li>"}),i+="</ul></div>",$(e.tableOfContents.container).append(i)}),$(this.layout.pageStatus).find("span.total").html(this.totalPages),this.isResuming){var t=this.sanitize(this.xml.setup.title);this.selectPage(this.getStorageItem("sbplus-"+t))}else this.selectPage("0,0");if($(this.button.sidebar).on("click",this.toggleSidebar.bind(this)),$(this.button.widget).on("click",this.toggleWidget.bind(this)),$(this.button.menu).on("click",this.toggleMenu.bind(this)),$(this.button.author).on("click",function(){e.openMenuItem("sbplus_author_profile")}),$(this.button.next).on("click",this.goToNextPage.bind(this)),$(this.button.prev).on("click",this.goToPreviousPage.bind(this)),$(this.tableOfContents.header).on("click",this.toggleSection.bind(this)),$(this.tableOfContents.page).on("click",this.selectPage.bind(this)),$(this.widget.segment).on("click","button",this.selectSegment.bind(this)),"on"===this.xml.settings.mathjax&&MathJax.Hub.Queue(["Typeset",MathJax.Hub]),$.isEmptyObject(e.downloads))$(e.button.downloadWrapper).hide();else{this.layout.dwnldMenu=new MenuBar($(this.button.download)[0].id,!1);for(var s in e.downloads)SBPLUS.isEmpty(e.downloads[s])||$(e.button.downloadMenu).append('<li class="menu-item" tabindex="-1" role="menuitem" aria-live="polite"><a download href="'+e.downloads[s]+'">'+e.capitalizeFirstLetter(s)+"</a></li>")}},goToNextPage:function(){var e=$(".sb_selected").data("page").split(","),t=Number(e[0]),s=Number(e[1]),a=this.xml.sections.length,i=$(this.xml.sections[t]).find("page").length;s++,s>i-1&&(t++,t>a-1&&(t=0),s=0),this.selectPage(t+","+s)},goToPreviousPage:function(){var e=$(".sb_selected").data("page").split(","),t=Number(e[0]),s=Number(e[1]);s--,s<0&&(t--,t<0&&(t=this.xml.sections.length-1),s=$(this.xml.sections[t]).find("page").length-1),this.selectPage(t+","+s)},updatePageStatus:function(e){$(this.layout.pageStatus).find("span.current").html(e)},hideSplash:function(){return $(this.splash.screen).addClass("fadeOut").one("webkitAnimationEnd mozAnimationEnd animationend",function(){$(this).removeClass("fadeOut").hide(),$(this).off()}),$(this.splash.screen)},startPresentation:function(){var e=this;e.presentationStarted===!1&&(e.hideSplash().promise().done(function(){e.renderPresentation()}),e.presentationStarted=!0)},resumePresentation:function(){var e=this;e.presentationStarted===!1&&(e.hideSplash().promise().done(function(){e.isResuming=!0,e.renderPresentation()}),e.presentationStarted=!0)},toggleSidebar:function(){$(this.layout.sidebar).is(":visible")?this.hideSidebar():this.showSidebar()},hideSidebar:function(){var e=$(this.layout.widget),t=$(this.layout.media);$(this.layout.sidebar).hide(),$(this.button.sidebar).html('<span class="icon-sidebar-open"></span>'),e.is(":visible")&&e.outerHeight()<=190&&t.removeClass("aspect_ratio").addClass("non_aspect_ratio"),t.removeClass("sidebar_on").addClass("sidebar_off"),this.resetMenu()},showSidebar:function(){var e=$(this.layout.widget),t=$(this.layout.media);$(this.layout.sidebar).show(),$(this.button.sidebar).html('<span class="icon-sidebar-close"></span>'),e.is(":visible")&&e.outerHeight()<=190&&t.removeClass("non_aspect_ratio").addClass("aspect_ratio"),t.removeClass("sidebar_off").addClass("sidebar_on")},toggleSection:function(e){var t=$(this.tableOfContents.header).length;if(t>1){var s;if(e instanceof Object)s=$(e.currentTarget);else{if(Number(e)>t-1)return!1;s=$(".header:eq("+e+")")}var a=$(s.siblings(".list")),i=s.find(".icon");a.is(":visible")?(a.slideUp(),i.html('<span class="icon-open"></span>')):(a.slideDown(),i.html('<span class="icon-collapse"></span>'))}},selectPage:function(e){var t;if(e instanceof Object)t=$(e.currentTarget);else if(t=$('.item[data-page="'+e+'"]'),0===t.length)return!1;if(!t.hasClass("sb_selected")){var s=$(this.tableOfContents.page),a=$(this.tableOfContents.header);if(a.length>1){var i=t.parent().siblings(".header");i.hasClass("current")||(a.removeClass("current"),i.addClass("current"))}s.removeClass("sb_selected"),t.addClass("sb_selected"),this.getPage(t.data("page")),this.updatePageStatus(t.data("count")),this.updateScroll(t[0])}},getPage:function(e){e=e.split(",");var t=e[0],s=e[1],a=$($(this.xml.sections[t]).find("page")[s]),i={title:a.attr("title").trim(),type:a.attr("type").trim().toLowerCase()};i.number=e,"quiz"!==i.type?(i.src=a.attr("src").trim(),i.notes=this.stripScript(a.find("note").text().trim()),i.widget=a.find("widget"),i.frames=a.find("frame"),i.imageFormat=this.xml.settings.imgType,i.transition=a[0].hasAttribute("transition")?a.attr("transition").trim():""):i.quiz=a,this.currentPage=new Page(i),this.currentPage.getPageMedia()},updateScroll:function(e){var t=$(this.tableOfContents.container).height(),s=$(e).outerHeight(),a=$(e).offset().top-s;a>t&&e.scrollIntoView(!1),a<s&&e.scrollIntoView(!0)},toggleMenu:function(){$(this.menu.menuPanel).is(":visible")?this.hideMenu():this.showMenu()},showMenu:function(){$(this.layout.sidebar).is(":visible")||this.showSidebar();var e=$(this.menu.menuPanel);$(this.button.menu).html('<span class="icon-close"></span>').addClass("menu_opened"),$(this.menu.menuBar).find(".title").html("Menu"),e.show().addClass("slideInRight").one("webkitAnimationEnd mozAnimationEnd animationend",function(){$(this).removeClass("slideInRight"),$(this).off()}),$(this.menu.menuItem).on("click",this.openMenuItem.bind(this)),this.clickCount++},hideMenu:function(){var e=this,t=$(this.menu.menuPanel),s=$(this.menu.menuBar);s.find(".title").html("Table of Contents"),t.addClass("slideOutRight").one("webkitAnimationEnd mozAnimationEnd animationend",function(){t.hide().removeClass("slideOutRight"),e.resetMenu(),$(this).off()})},openMenuItem:function(e){var t=this;$(this.splash.screen).is(":visible")&&this.hideSplash(),$(this.menu.menuPanel).is(":visible")||this.showMenu();var s="";s="string"==typeof e?e:e.currentTarget.id;var a=$(this.menu.menuBar),i=$(this.menu.menuList),r=$(this.menu.menuContentWrapper),n=$(this.menu.menuContent),o=$("#"+s),l=a.find(".backBtn");a.removeClass("full"),a.find(".title").html(o.html()),n.empty(),$(".profileImg").length&&$(".profileImg").remove(),i.hasClass("fadeOutLeft")||r.is(":visible")||(l.show().prop("disabled",!1).one("click",this.closeMenuContent.bind(this)),i.addClass("fadeOutLeft").one("webkitAnimationEnd mozAnimationEnd animationend",function(){$(this).hide().removeClass("fadeOutLeft"),r.fadeIn(),$(this).off()}));var u="";switch(s){case"sbplus_author_profile":if(r.prepend('<div class="profileImg"></div>'),0===t.xml.setup.authorPhoto.length){var d=t.xml.setup.author,p=t.sanitize(d),c=t.manifest.sbplus_author_directory+p+".jpg";$.ajax({type:"HEAD",url:"assets/"+p+".jpg"}).done(function(){t.xml.setup.authorPhoto=this.url;var e='<img src="';e+=this.url+'" alt="Photo of '+d+'" crossorigin="Anonymous" />',$(".profileImg").html(e)}).fail(function(){$.ajax({type:"HEAD",url:c}).done(function(){t.xml.setup.authorPhoto=this.url;var e='<img src="';e+=this.url+'" alt="Photo of '+d+'" crossorigin="Anonymous" />',$(".profileImg").html(e)})})}else{var m='<img src="';m+=t.xml.setup.authorPhoto+'" alt="Photo of '+d+'" crossorigin="Anonymous" />',$(".profileImg").prepend(m)}u='<p class="name">'+t.xml.setup.author+"</p>",u+=t.xml.setup.profile;break;case"sbplus_general_info":u=t.xml.setup.generalInfo;break;case"sbplus_settings":this.hasStorageItem("sbplus-settings-loaded",!0)===!1?$.get(t.manifest.sbplus_root_directory+"scripts/templates/settings.tpl",function(e){t.settings=e,t.setStorageItem("sbplus-settings-loaded",1,!0),n.append(e),t.afterSettingsLoaded()}):(n.append(t.settings),t.afterSettingsLoaded()),u="";break;default:var h=t.manifest.sbplus_custom_menu_items;for(var g in h){var b="sbplus_"+t.sanitize(h[g].name);if(s===b){u=h[g].content;break}}}n.append(u),"on"===t.xml.settings.mathjax&&MathJax.Hub.Queue(["Typeset",MathJax.Hub])},closeMenuContent:function(){var e=$(this.menu.menuBar),t=$(this.menu.menuList),s=$(this.menu.menuContentWrapper),a=$(this.menu.menuContent);e.addClass("full").find(".title").html("Menu"),t.show().addClass("fadeInLeft"),a.empty(),s.hide(),$(".profileImg").length&&$(".profileImg").remove(),t.one("webkitAnimationEnd mozAnimationEnd animationend",function(){$(this).removeClass("fadeInLeft"),$(this).off()}),$(this).prop("disabled",!0),$(this).off("click")},resetMenu:function(){if(!$(this.menu.menuPanel).is(":visible")){var e=$(this.menu.menuBar),t='<span class="icon-menu"></span>';e.find(".title").html("Table of Contents"),e.addClass("full"),e.find(".backBtn").hide().prop("disabled",!0),this.clickCount>=this.randomNum?(t="",this.clickCount=0,this.randomNum=Math.floor(10*Math.random()+1)):t='<span class="icon-menu"></span>',$(this.button.menu).html(t).removeClass("menu_opened"),$(this.menu.menuList).show(),$(this.menu.menuContent).empty(),$(this.menu.menuContentWrapper).hide(),$(this.menu.menuItem).off("click")}},toggleWidget:function(){$(this.layout.widget).is(":visible")?this.hideWidget():this.showWidget()},hideWidget:function(){var e=$(this.layout.media);$(this.layout.widget).hide(),$(this.button.widget).html('<span class="icon-widget-open"></span>'),this.layout.isMobile?(e.addClass("aspect_ratio"),this.resize()):e.removeClass("aspect_ratio").addClass("non_aspect_ratio").css("height","100%"),e.removeClass("widget_on").addClass("widget_off")},showWidget:function(){var e=$(this.layout.media);$(this.layout.widget).show(),$(this.button.widget).html('<span class="icon-widget-close"></span>'),e.removeClass("non_aspect_ratio").addClass("aspect_ratio").css("height",""),this.resize(),e.removeClass("widget_off").addClass("widget_on")},disableWidget:function(){$(this.button.widget).prop("disabled",!0).addClass("sb_disabled")},enableWidget:function(){$(this.button.widget).prop("disabled",!1).removeClass("sb_disabled")},selectSegment:function(e){var t=this,s=$(this.widget.segment).find("button");if(s.length>0){$(this.layout.widget).removeClass("noSegments");var a="",i="";"string"==typeof e?(a=$("#"+e),i=e):(a=$(e.currentTarget),i=a[0].id),a.hasClass("active")||(this.currentPage.getWidgetContent(i),s.removeClass("active"),a.addClass("active")),"on"===this.xml.settings.mathjax&&MathJax.Hub.Queue(["Typeset",MathJax.Hub]),clearInterval(transcriptInterval)}else if($(this.layout.widget).addClass("noSegments"),this.hasStorageItem("sbplus-logo-loaded",!0)===!1){var r=this.xml.setup.program;SBPLUS.isEmpty(r)&&(r=SBPLUS.getProgramDirectory(),SBPLUS.isEmpty(r)&&(r=this.manifest.sbplus_logo_default));var n=this.manifest.sbplus_logo_directory+r+".svg";$.get(n,function(){t.setStorageItem("sbplus-logo-loaded",this.url,!0),$(t.widget.bg).css("background-image","url("+t.getStorageItem("sbplus-logo-loaded",!0)+")")}).fail(function(){n=t.manifest.sbplus_logo_directory+t.manifest.sbplus_logo_default+".svg",$.get(n,function(){t.setStorageItem("sbplus-logo-loaded",this.url,!0),$(t.widget.bg).css("background-image","url("+t.getStorageItem("sbplus-logo-loaded",!0)+")")})})}else $(t.widget.bg).css("background-image","url("+t.getStorageItem("sbplus-logo-loaded",!0)+")")},selectFirstSegment:function(){var e=$(this.widget.segment).find("button")[0],t=$(e).attr("id");this.selectSegment(t)},addSegment:function(e){var t='<button id="sbplus_'+this.sanitize(e)+'">'+e+"</button>";this.widget.segments.push(e),"Notes"===e?$(this.widget.segment).prepend(t):$(this.widget.segment).append(t)},clearWidgetSegment:function(){$(this.widget.segment).empty(),$(this.widget.content).empty(),$(this.widget.bg).css("background-image",""),this.widget.segments=[]},setManifestOptions:function(){if(this.hasStorageItem("sbplus-manifest-options-loaded",!0)!==!1)return"Manifest options already loaded.";this.setStorageItem("sbplus-manifest-options-loaded",1,!0);var e=this.manifest.sbplus_custom_menu_items;if(e.length)for(var t in e){var s=e[t].name,a=this.sanitize(s),i='<li class="menu item" id="sbplus_'+a+'"><span class="icon-'+a+'"></span> '+s+"</li>";$(this.menu.menuList).append(i)}},checkForSupport:function(){return Modernizr.video&&Modernizr.eventlistener&&Modernizr.json&&Modernizr.flexbox&&Modernizr.flexwrap&&Modernizr.csscalc?1:0},showErrorScreen:function(e){if(this.hasError&&e.length){var t=this.manifest.sbplus_root_directory;switch($(this.layout.sbplus).hide(),e){case"support":t+="scripts/templates/support_error.tpl";break;case"xml":t+="scripts/templates/xml_error.tpl";break;case"parser":t+="scripts/templates/xml_parse_error.tpl";break;default:t=""}if(t.length){var s=this;$.get(t,function(e){$(s.layout.errorScreen).html(e).show().addClass("shake").css("display","flex")})}}},calcLayout:function(){var e=$(this.layout.media),t=$(this.layout.widget),s=$(this.layout.sidebar);window.innerWidth>=1826?e.removeClass("aspect_ratio").addClass("non_aspect_ratio"):e.removeClass("non_aspect_ratio").addClass("aspect_ratio"),t.is(":visible")||e.css("height","100%"),window.innerWidth<=740||window.screen.width<=414?this.layout.isMobile=!0:this.layout.isMobile=!1,this.layout.isMobile===!1&&t.outerHeight()<=190&&e.removeClass("aspect_ratio").addClass("non_aspect_ratio"),this.layout.isMobile===!0?s.css("max-height","400px"):s.css("max-height",""),this.calcWidgetHeight()},calcWidgetHeight:function(){var e=$(this.layout.sidebar),t=$(this.layout.widget);this.layout.isMobile===!0?t.css({"min-height":e.outerHeight(),bottom:e.outerHeight()*-1}):t.css({"min-height":"",bottom:""})},resize:function(){this.calcLayout(),this.layout.isMobile&&this.showSidebar()},setURLOptions:function(){var e=$(this.layout.html),t=$(this.layout.wrapper);"1"===this.getUrlParam("fullview")?(e.addClass("sbplus_pop_full"),t.removeClass("sbplus_boxed").addClass("sbplus_full")):(e.removeClass(".sbplus_pop_full"),t.addClass("sbplus_boxed").removeClass("sbplus_full"))},getUrlParam:function(e){var t=new RegExp("[?&]"+e+"=([^&#]*)").exec(window.location.href);return null===t?null:t[1]||0},getManifestUrl:function(){var e=$("#sbplus_configs");return e.length?e[0].href:""},sanitize:function(e){return e.replace(/[^\w]/gi,"").toLowerCase()},capitalizeFirstLetter:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},isEmpty:function(e){return void 0===e||null===e||!e.trim()||0===e.trim().length},colorLum:function(e,t){e=String(e).replace(/[^0-9a-f]/gi,""),e.length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),t=t||0;var s="#",a,i;for(i=0;i<3;i++)a=parseInt(e.substr(2*i,2),16),a=Math.round(Math.min(Math.max(0,a+a*t),255)).toString(16),s+=("00"+a).substr(a.length);return s},colorContrast:function(e){return e=parseInt(e.slice(1),16),e>8388607.5?"#000":"#fff"},stripScript:function(e){if(""!==e||void 0!==e){var t=$("<span>"+$.trim(e)+"</span>");return t.find("script,noscript,style").remove().end(),t.html()}return e},hexToRgb:function(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,s,a){return t+t+s+s+a+a});var s=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);
return s?parseInt(s[1],16)+","+parseInt(s[2],16)+","+parseInt(s[3],16):null},getProgramDirectory:function(){var e=this.getUrlArray(e);return e.length>=3?e[e.length-2]:2===e.length?e[0]:""},getCourseDirectory:function(){var e=this.getUrlArray(e);return e.length>=2?e[e.length-1]:""},getUrlArray:function(){var e=window.location.href,t=e.split("/");return t.splice(0,1),t[t.length-1].indexOf(".")>=0&&t.splice(t.length-1,1),this.removeEmptyElements(t)},removeEmptyElements:function(e){for(var t=!1,s=0;s<e.length;s++)SBPLUS.isEmpty(e[s])&&(t=!0),e[s].match(/^[0-9]+$/m)&&(t=!0),t&&(e.splice(s,1),t=!1);return e},setStorageItem:function(e,t,s){s?sessionStorage.setItem(e,t):localStorage.setItem(e,t)},getStorageItem:function(e,t){return t?sessionStorage.getItem(e):localStorage.getItem(e)},deleteStorageItem:function(e,t){return t?sessionStorage.removeItem(e):localStorage.getItem(e)},hasStorageItem:function(e,t){return t?!this.isEmpty(sessionStorage.getItem(e)):!this.isEmpty(localStorage.getItem(e))},removeAllSessionStorage:function(){this.deleteStorageItem("sbplus-manifest-loaded",!0),this.deleteStorageItem("sbplus-manifest-options-loaded",!0),this.deleteStorageItem("sbplus-template-loaded",!0),this.deleteStorageItem("sbplus-xml-loaded",!0),this.deleteStorageItem("sbplus-xml-parsed",!0),this.deleteStorageItem("sbplus-logo-loaded",!0),this.deleteStorageItem("sbplus-kaltura-loaded",!0),this.deleteStorageItem("sbplus-settings-loaded",!0),this.deleteStorageItem("sbplus-playbackrate-temp",!0),this.deleteStorageItem("sbplus-volume-temp",!0),this.deleteStorageItem("sbplus-subtitle-temp",!0),this.deleteStorageItem("sbplus-vjs-yt-loaded",!0),this.deleteStorageItem("sbplus-vjs-vimeo-loaded",!0),this.deleteStorageItem("sbplus-previously-widget-open",!0)},isMobileDevice:function(){return!(!navigator.userAgent.match(/iPhone/i)&&!navigator.userAgent.match(/iPod/i))},afterSettingsLoaded:function(){var e=this;"1"===e.getStorageItem("sbplus-settings-loaded",!0)&&(e.isMobileDevice()&&($("#autoplay_label").after('<p class="error">Mobile devices do not support autoplay.</p>'),$("#sbplus_va_autoplay").prop("checked",!1).attr("disabled",!0)),e.syncSettings(),$("#save_settings").on("click",function(t){var s=this;$(s).prop("disabled",!0).html("Saving..."),$("#sbplus_gs_widget").is(":checked")?e.setStorageItem("sbplus-hide-widget",1):e.setStorageItem("sbplus-hide-widget",0),$("#sbplus_gs_sidebar").is(":checked")?e.setStorageItem("sbplus-hide-sidebar",1):e.setStorageItem("sbplus-hide-sidebar",0),$("#sbplus_gs_it").is(":checked")?e.setStorageItem("sbplus-disable-it",1):e.setStorageItem("sbplus-disable-it",0),$("#sbplus_va_autoplay").is(":checked")?e.setStorageItem("sbplus-autoplay",1):e.setStorageItem("sbplus-autoplay",0),$("#sbplus_va_subtitle").is(":checked")?e.setStorageItem("sbplus-subtitle",1):e.setStorageItem("sbplus-subtitle",0);var a=$("#sbplus_va_volume").val(),i=!1;return a<0||a>100||e.isEmpty(a)?(i=!0,a=100*Number(e.getStorageItem("sbplus-volume"))):(e.setStorageItem("sbplus-volume",a/100),e.setStorageItem("sbplus-volume-temp",a/100,!0)),i?$("#volume_label").after('<p class="error">Value must be between 0 and 100.</p>'):$("#volume_label").next(".error").remove(),e.setStorageItem("sbplus-playbackrate",$("#sbplus_va_playbackrate option:selected").val()),e.setStorageItem("sbplus-playbackrate-temp",$("#sbplus_va_playbackrate option:selected").val(),!0),setTimeout(function(){$(s).prop("disabled",!1).html("Save")},1500),t.preventDefault(),!1}))},syncSettings:function(){var e=this;if("1"===e.getStorageItem("sbplus-settings-loaded",!0)){var t=e.getStorageItem("sbplus-hide-widget");"1"===t?$("#sbplus_gs_widget").prop("checked",!0):$("#sbplus_gs_widget").prop("checked",!1);var s=e.getStorageItem("sbplus-hide-sidebar");"1"===s?$("#sbplus_gs_sidebar").prop("checked",!0):$("#sbplus_gs_sidebar").prop("checked",!1);var a=e.getStorageItem("sbplus-disable-it");"1"===a?$("#sbplus_gs_it").prop("checked",!0):$("#sbplus_gs_it").prop("checked",!1);var i=e.getStorageItem("sbplus-autoplay");e.isMobileDevice()===!1&&("1"===i?$("#sbplus_va_autoplay").prop("checked",!0):$("#sbplus_va_autoplay").prop("checked",!1));var r=e.getStorageItem("sbplus-volume");$("#sbplus_va_volume").prop("value",100*r);var n=e.getStorageItem("sbplus-playbackrate");$("#sbplus_va_playbackrate").val(n);var o=e.getStorageItem("sbplus-subtitle");"1"===o?$("#sbplus_va_subtitle").prop("checked",!0):$("#sbplus_va_subtitle").prop("checked",!1)}}};$(function(){SBPLUS.go()});