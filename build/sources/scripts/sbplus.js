/*
 * Storybook Plus
 *
 * @author: Ethan Lin
 * @url: https://github.com/uwex-learning-tech/sbplus_v3
 * @version: 3.3.3
 * Released 11/29/2021
 *
 * @license: GNU GENERAL PUBLIC LICENSE v3
 *
    Storybook Plus is an web application that serves multimedia contents.
    Copyright (C) 2013-2021  Ethan S. Lin, Learning Technology & Media, University
    of Wisconsin Extended Campus

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *
 */
"use strict";function copyToClipboard(){const e=document.getElementById("copyToCbBtn"),t=e.querySelectorAll(".btn-txt")[0],a=document.getElementById("copyableTxt"),s=e.innerHTML;e&&a&&(a.select(),document.execCommand("copy"),e.focus(),t.innerHTML="Copied",setTimeout((function(){t.innerHTML=s}),3e3))}function getKalturaStatus(e){var t="";switch(e){case-1:t="ERROR";break;case 0:t="QUEUED (queued for conversion)";break;case 1:t="CONVERTING";break;case 2:t="READY";break;case 3:t="DELETED";break;case 4:t="NOT APPLICABLE";break;default:t="UNKNOWN ERROR (check main entry)";break}return t}function getEntryKalturaStatus(e){var t="";switch(e){case-2:t="ERROR IMPORTING";break;case-1:t="ERROR CONVERTING";break;case 0:t="IMPORTING";break;case 1:t="PRECONVERT";break;case 2:t="READY";break;case 3:t="DELETED";break;case 4:t="PENDING MODERATION";break;case 5:t="MODERATE";break;case 6:t="BLOCKED";break;default:t="UNKNOWN ERROR (check entry ID)";break}return t}function addForwardButton(e){let t=10,a=videojs.getComponent("Button"),s=videojs.extend(a,{constructor:function(e,t){a.call(this,e,t),this.el().setAttribute("aria-label","Skip Forward"),this.controlText("Skip Forward")},handleClick:function(){if(e.seekable()){let a=e.currentTime()+t;a>=e.duration()&&(a=e.duration()),e.currentTime(a)}},buildCSSClass:function(){return"vjs-forward-button vjs-control vjs-button"}});videojs.registerComponent("ForwardBtn",s),e.getChild("controlBar").addChild("ForwardBtn",{},1)}function addBackwardButton(e){let t=10,a=videojs.getComponent("Button"),s=videojs.extend(a,{constructor:function(e,t){a.call(this,e,t),this.el().setAttribute("aria-label","Skip Backward"),this.controlText("Skip Backward")},handleClick:function(){if(e.seekable()){let a=e.currentTime()-t;a<=0&&(a=0),e.currentTime(a)}},buildCSSClass:function(){return"vjs-backward-button vjs-control vjs-button"}});videojs.registerComponent("BackwardBtn",s),e.getChild("controlBar").addChild("BackwardBtn",{},1)}function sendKAnalytics(e,t,a,s){var r={url:"https://www.kaltura.com/api_v3/service/stats/action/collect",method:"POST",timeout:0,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{"event[entryId]":a,"event[partnerId]":t,"event[duration]":s,"event[eventType]":e,"event[referrer]":"https://media.uwex.edu","event[seek]":"false","event[sessionId]":guid(),"event[eventTimestamp]":+new Date,"event[objectType]":"KalturaStatsEvent"}};$.ajax(r)}function displayWidgetContent(e){$(SBPLUS.widget.content).html(e).addClass("fadeIn").one("webkitAnimationEnd mozAnimationEnd animationend",(function(){var e=$(this);e.removeClass("fadeIn").off(),e.find("a").length&&e.find("a").each((function(){$(this).attr("target","_blank")}))}))}function parseTranscript(e){try{var t='<div class="lt-wrapper">',a=e.replace(/\n/g,"<br>").split("<br>"),s=0;(a=cleanArray(SBPLUS.removeEmptyElements(a)))[0].match(/\d{2}:\d{2}:\d{2}.\d{3}/g)&&a[1].match(/\d{2}:\d{2}:\d{2}.\d{3}/g)&&(a[0]="",a=SBPLUS.removeEmptyElements(a));for(var r=1;r<a.length;r+=2){var i=a[r-1].split(" ");t+='<span class="lt-line" data-start="'+toSeconds(i[0])+'" data-end="'+toSeconds(i[2])+'">'+a[r]+"</span> ",++s>=17&&(t+="<br><br>",s=0)}return t+="</div>"}catch(e){return"Oops, SB+ has some complications with the requested caption file."}}function cleanArray(e){var t=(e=SBPLUS.removeEmptyElements(e)).findIndex(firstCueZero);-1===t&&(t=e.indexOf(e.find(firstCue))),e=e.splice(t);for(var a=0;a<e.length;a++)if(e[a].match(/\d{2}:\d{2}:\d{2}.\d{3}/g)){var s=e[a].split(" ");if(!(s.length>3))continue;e[a]=s.splice(0,3).join(" ")}else void 0!==e[a+1]&&(e[a+1].match(/\d{2}:\d{2}:\d{2}.\d{3}/g)||(e[a]=e[a]+" "+e[a+1],e[a+1]=""));return SBPLUS.removeEmptyElements(e)}function guid(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function firstCueZero(e){return e.match(/(00:00:00.000)/)}function firstCue(e){return e.match(/\d{2}:\d{2}:\d{2}.\d{3}/g)}function toSeconds(e){var t=e.split(":");return t.length>=3?60*Number(60*t[0])+Number(60*t[1])+Number(t[2]):Number(60*t[0])+Number(t[1])}function isUrl(e){var t;return/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(e)}function questionExists(e){var t=!1;return $.each(quizTracker,(function(a){quizTracker[a].id!==e||(t=!0)})),t}function shuffle(e){var t,a,s;for(s=e.length;s;s--)t=Math.floor(Math.random()*s),a=e[s-1],e[s-1]=e[t],e[t]=a}function getCurrentQuizItem(e,t){var a=void 0;return $.each(e,(function(s){if(e[s].id===t)return a=s,!1})),a}function MenuBar(e,t){this.id=$("#"+e),this.rootItems=this.id.children("li"),this.items=this.id.find(".menu-item").not(".separator"),this.parents=this.id.find(".menu-parent"),this.allItems=this.parents.add(this.items),this.activeItem=null,this.isVerticalMenu=t,this.bChildOpen=!1,this.keys={tab:9,enter:13,esc:27,space:32,left:37,up:38,right:39,down:40},this.bindHandlers()}var worker,SBPLUS=SBPLUS||{loadingScreen:null,themeDecorationBar:null,layout:null,splash:null,banner:null,tableOfContents:null,widget:null,button:null,menu:null,screenReader:null,presentationLoc:"",logo:"",totalPages:0,currentPage:null,targetPage:null,manifest:null,xml:null,downloads:{},settings:null,manifestLoaded:!1,splashScreenRendered:!1,presentationRendered:!1,beforeXMLLoadingDone:!1,xmlLoaded:!1,xmlParsed:!1,presentationStarted:!1,hasError:!1,kalturaLoaded:!1,alreadyResized:!1,playbackrate:1,gaTimeouts:{start:null,halfway:null,completed:null},clickCount:0,randomNum:Math.floor(6*Math.random()+5),go:function(){if(this.layout={isMobile:!1,html:"html",wrapper:".sbplus_wrapper",sbplus:"#sbplus",errorScreen:"#sbplus_error_screen",widget:"#sbplus_widget",media:"#sbplus_media_wrapper",mediaContent:"#sbplus_media_wrapper .sbplus_media_content",mediaError:"#sbplus_media_wrapper .sbplus_media_error",mediaMsg:"#sbplus_media_wrapper .sbplus_media_msg",leftCol:"#sbplus_left_col",sidebar:"#sbplus_right_col",pageStatus:"#sbplus_page_status",quizContainer:"#sbplus_quiz_wrapper",mainControl:"#sbplus_control_bar",dwnldMenu:null,mainMenu:null},this.banner={title:"#sbplus_lession_title",author:"#sbplus_author_name"},this.splash={screen:"#sbplus_splash_screen",background:"#sb_splash_bg",title:"#sbplus_presentation_info .sb_title",subtitle:"#sbplus_presentation_info .sb_subtitle",author:"#sbplus_presentation_info .sb_author",duration:"#sbplus_presentation_info .sb_duration",downloadBar:"#sbplus_presentation_info .sb_downloads"},this.tableOfContents={container:"#sbplus_table_of_contents_wrapper",header:".section .header",page:".section .list .item"},this.widget={bar:"#sbplus_widget .widget_controls_bar",segment:"#sbplus_widget .widget_controls_bar .tab_segment",segments:[],content:"#sbplus_widget .segment_content"},this.button={start:"#sbplus_start_btn",resume:"#sbplus_resume_btn",downloadWrapper:"#sbplus_download_btn_wrapper",download:"#sbplus_download_btn",downloadMenu:"#sbplus_download_btn .menu-parent .downloadFiles",widget:"#sbplus_widget_btn",widgetTip:"#sbplus_widget_btn .btnTip",sidebar:"#sbplus_sidebar_btn",author:"#sbplus_author_name",menu:"#sbplus_menu_btn",menuClose:"#sbplus_menu_close_btn",next:"#sbplus_next_btn",prev:"#sbplus_previous_btn"},this.menu={menuList:"#sbplus_menu_btn_wrapper .menu",menuContentList:"#menu_item_content .menu",menuBarTitle:"#menu_item_content .sbplus_menu_title_bar .title",menuContentWrapper:"#menu_item_content",menuContent:"#menu_item_content .content",menuSavingMsg:"#save_settings"},this.screenReader={pageStatus:".sr-page-status",currentPage:".sr-page-status .sr-current-page",totalPages:".sr-page-status .sr-total-pages",pageTitle:".sr-page-status .sr-page-title",hasNotes:".sr-page-status .sr-has-notes"},this.themeDecorationBar="#theme-decoration-bar",this.loadingScreen={wrapper:"#sbplus_loading_screen",logo:"#sbplus_loading_screen .program_logo"},null===this.manifest){var e=this;$.getJSON(e.getManifestUrl(),(function(t){e.manifest=t,e.manifestLoaded=!0,$(window).on("unload",e.removeAllSessionStorage.bind(e)),e.isEmpty(e.manifest.sbplus_root_directory)&&(e.manifest.sbplus_root_directory="sources/"),e.loadTemplate()})).fail((function(){var t='<div class="error">';t+="<p><strong>Storybook Plus Error:</strong> ",t+="failed to load the manifest file.<br>",t+="Expecting: <code>"+this.url+"</code></p>",t+="</div>",$(e.layout.wrapper).html(t)}))}},loadTemplate:function(){var e=this;if(window.self!==window.top&&$(e.layout.wrapper).addClass("loaded-in-iframe"),e.manifestLoaded){var t=e.manifest.sbplus_root_directory;t+="scripts/templates/sbplus.tpl",$.get(t,(function(t){if($(e.layout.wrapper).html(t),$(window).on("resize",e.resize.bind(e)),0===e.checkForSupport())return e.hasError=!0,e.showErrorScreen("support"),!1;e.beforeXMLLoading(),e.loadXML()})).fail((function(){var t='<div class="error">';t+="<p><strong>Storybook Plus Error:</strong> ",t+="failed to load template.<br>",t+="Expecting: <code>"+this.url+"</code></p>",t+="</div>",$(e.layout.wrapper).html(t)}))}},setTheme:function(){var e=this;if(e.manifestLoaded){var t=e.xml.setup.program;e.isEmpty(t)&&(t=SBPLUS.getProgramDirectory(),e.isEmpty(t)&&(t=e.manifest.sbplus_program_default));let a=new Date;$("#copyright-footer .copyright-year").html(a.getFullYear()+"."),$.getJSON(e.manifest.sbplus_program_themes,(function(a){let s;e.getProgramTheme(0,t,a).forEach((function(t){$(e.themeDecorationBar).append('<span style="background-color:'+t+'"></span>')})),$("#copyright-footer .notice").html(a.copyright)})).fail((function(){}))}},getProgramTheme:function(e,t,a){let s=this,r=a.program_themes.filter((e=>e.name===t)),i=[];return r.length?i=r[0].colors:e<3&&(s.isEmpty(s.manifest.sbplus_program_default)||(i=s.getProgramTheme(e+1,s.manifest.sbplus_program_default,a))),i},getLogo:function(){var e=this;if(e.isEmpty(e.logo)){var t=this.xml.setup.program;SBPLUS.isEmpty(t)&&(t=SBPLUS.getProgramDirectory(),SBPLUS.isEmpty(t)&&(t=this.manifest.sbplus_program_default));var a=this.manifest.sbplus_logo_directory+t+".svg";$.ajax({url:a,type:"HEAD"}).done((function(){e.logo=this.url,$(e.loadingScreen.logo).html('<img src="'+e.logo+'" />')})).fail((function(){a=e.manifest.sbplus_logo_directory+e.manifest.sbplus_program_default+".svg",$.ajax({url:a,type:"HEAD"}).done((function(){e.logo=this.url,$(e.loadingScreen.logo).html('<img src="'+e.logo+'" />')})).fail((function(){e.logo=e.manifest.sbplus_root_directory+"images/default_logo.svg"}))}))}},beforeXMLLoading:function(){!0===this.manifestLoaded&&!1===this.beforeXMLLoadingDone&&(this.setURLOptions(),this.setManifestCustomMenu(),this.beforeXMLLoadingDone=!0)},setManifestCustomMenu:function(){if(this.manifestLoaded){var e=this.manifest.sbplus_custom_menu_items;if(e.length)for(var t in e){var a=e[t].name,s=this.sanitize(a),r='<li tabindex="-1" role="menuitem" aria-live="polite" class="menu-item sbplus_'+s+'"><a href="javascript:void(0);" onclick="SBPLUS.openMenuItem(\'sbplus_'+s+'\');"><span class="icon-'+s+'"></span> '+a+"</a></li>";$(this.menu.menuList).append(r)}$(this.menu.menuContentList).html($(this.menu.menuList).html())}},loadXML:function(){if(this.beforeXMLLoadingDone){var e=this,t="assets/sbplus.xml?_="+(new Date).getTime();$.get(t,(function(t){e.xmlLoaded=!0,e.parseXMLData(t)})).fail((function(t,a){e.hasError=!0,"parsererror"===a?e.showErrorScreen("parser"):e.showErrorScreen("xml")}))}},parseXMLData:function(e){var t=this,a,s,r,i,n,o;if(t.xmlLoaded){var l=$(e),u=l.find("storybook"),d=l.find("setup"),c=t.trimAndLower(u.attr("accent")),p=t.trimAndLower(u.attr("pageImgFormat")),m="svg",g=t.trimAndLower(u.attr("analytics")),h="",b=u.attr("xmlVersion"),f="",v=t.trimAndLower(d.attr("course")),S=t.noScript(d.find("title").text().trim()),y=t.noScript(d.find("subtitle").text().trim()),w=d.find("length").text().trim(),_=d.find("author"),k=t.getTextContent(d.find("generalInfo")),P=l.find("section"),x=u.attr("splashImgFormat"),C=d.attr("program");if(x&&(t.isEmpty(x)||(m=t.trimAndLower(x))),C&&(f=t.trimAndLower(C)),t.isEmpty(c)&&(c=t.manifest.sbplus_default_accent),t.isEmpty(p)&&(p="jpg"),"on"!==g&&"true"!==g&&(g="off"),t.isEmpty(u.attr("mathjax"))?h="off":"on"!==t.trimAndLower(u.attr("mathjax"))&&"true"!==t.trimAndLower(u.attr("mathjax"))||(h="on"),t.xml={settings:{accent:c,imgType:p,splashImgType:m,analytics:g,mathjax:h,version:b},setup:{program:f,course:v,title:S,subtitle:y,author:_,authorPhoto:"",duration:w,generalInfo:k},sections:P},t.getLogo(),t.setTheme(),t.presentationLoc=t.sanitize(t.getCourseDirectory()),""!=t.manifest.sbplus_hotjar_site_id){var L=Number(t.manifest.sbplus_hotjar_site_id);a=window,s=document,r="https://static.hotjar.com/c/hotjar-",i=".js?sv=",a.hj=a.hj||function(){(a.hj.q=a.hj.q||[]).push(arguments)},a._hjSettings={hjid:L,hjsv:6},n=s.getElementsByTagName("head")[0],(o=s.createElement("script")).async=1,o.src=r+a._hjSettings.hjid+i+a._hjSettings.hjsv,n.appendChild(o)}if("on"!==t.xml.settings.analytics&&"true"!==t.xml.settings.analytics||(!function(e,t,a,s,r,i,n){e.GoogleAnalyticsObject=r,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,i=t.createElement(a),n=t.getElementsByTagName(a)[0],i.async=1,i.src=s,n.parentNode.insertBefore(i,n)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create",t.manifest.sbplus_google_tracking_id,"auto"),ga("set",{appName:"SBPLUS",appVersion:t.xml.settings.version})),_.length){var I=t.sanitize(_.attr("name").trim()),B=t.manifest.sbplus_author_directory+I+".json",E=t.getTextContent(_);t.xml.setup.author=_.attr("name").trim(),t.isEmpty(I)?(t.xml.setup.profile=E,t.xmlParsed=!0,t.renderSplashscreen()):$.ajax({crossDomain:!0,type:"GET",dataType:"jsonp",jsonpCallback:"author",url:B}).done((function(e){t.xml.setup.profileName=e.name,t.isEmpty(E)?t.xml.setup.profile=e.profile:t.xml.setup.profile=E,t.xmlParsed=!0,t.renderSplashscreen()})).fail((function(){t.xml.setup.profile=E,t.xmlParsed=!0,t.renderSplashscreen()}))}}},renderSplashscreen:function(){var e=this;if(!0===e.xmlParsed&&!1===e.splashScreenRendered){!1===e.hasStorageItem("sbplus-hide-widget")&&e.setStorageItem("sbplus-hide-widget",0),!1===e.hasStorageItem("sbplus-hide-sidebar")&&e.setStorageItem("sbplus-hide-sidebar",0),!1===e.hasStorageItem("sbplus-disable-it")&&e.setStorageItem("sbplus-disable-it",1),!1===e.hasStorageItem("sbplus-autoplay")&&e.setStorageItem("sbplus-autoplay",1),!1===e.hasStorageItem("sbplus-volume")&&e.setStorageItem("sbplus-volume",.8),!1===e.hasStorageItem("sbplus-playbackrate")?e.setStorageItem("sbplus-playbackrate",1):e.playbackrate=e.getStorageItem("sbplus-playbackrate"),!1===e.hasStorageItem("sbplus-subtitle")&&e.setStorageItem("sbplus-subtitle",0),e.hasStorageItem("sbplus-disable-it")&&e.deleteStorageItem("sbplus-disable-it"),"1"==e.getStorageItem("sbplus-autoplay")&&$(e.layout.wrapper).addClass("sbplus_autoplay_on"),$(document).attr("title",e.xml.setup.title),$(e.splash.title).html(e.xml.setup.title),$(e.splash.subtitle).html(e.xml.setup.subtitle),e.xml.setup.profileName?$(e.splash.author).html(e.xml.setup.profileName):$(e.splash.author).html(e.xml.setup.author),$(e.splash.duration).html(e.xml.setup.duration),$.ajax({url:"assets/splash."+e.xml.settings.splashImgType,type:"head"}).done((function(){e.setSplashImage(this.url)})).fail((function(){var t=e.xml.setup.program,a=e.xml.setup.course;if(e.isEmpty(t)&&(t=SBPLUS.getProgramDirectory()),e.isEmpty(a)&&(a=SBPLUS.getCourseDirectory(),e.isEmpty(a)&&(a="default")),a+="."+e.xml.settings.splashImgType,e.isEmpty(t)||e.isEmpty(a))e.setSplashImage(e.manifest.sbplus_root_directory+"images/default_splash.svg");else{var s=e.manifest.sbplus_splash_directory+t+"/"+a;$.ajax({url:s,type:"HEAD"}).done((function(){e.setSplashImage(this.url)})).fail((function(){e.setSplashImage(e.manifest.sbplus_root_directory+"images/default_splash.svg")}))}})),$(e.button.start).on("click",e.startPresentation.bind(e)),e.hasStorageItem("sbplus-"+e.presentationLoc)?$(e.button.resume).on("click",e.resumePresentation.bind(e)):$(e.button.resume).hide(0,(function(){$(e).attr("tabindex","-1")}));var t=SBPLUS.getCourseDirectory().replace(".sbproj","");if(e.isEmpty(t)&&(t="default"),e.manifest.sbplus_download_files.forEach((function(a){$.ajax({url:t+"."+a.format,type:"HEAD"}).done((function(){let s=a.label.toLowerCase();e.downloads[s]={fileName:t,fileFormat:a.format,url:this.url},$(e.splash.downloadBar).append('<a href="'+this.url+'" tabindex="1" download="'+t+"."+a.format+'" aria-label="Download '+s+' file" onclick="SBPLUS.sendToGA( \''+s+"Link', 'click', '"+t+'\', 4, 0 );"><span class="icon-download"></span> '+a.label+"</a>")}))})),e.xml.settings.accent!==e.manifest.sbplus_default_accent){var a=e.colorLum(e.xml.settings.accent,.2),s=e.colorContrast(e.xml.settings.accent),r=".sbplus_wrapper button:hover{color:"+e.xml.settings.accent+"}.sbplus_wrapper #sbplus #sbplus_splash_screen #sbplus_presentation_info .sb_cta button{color:"+s+";background-color:"+e.xml.settings.accent+"}.sbplus_wrapper #sbplus #sbplus_splash_screen #sbplus_presentation_info .sb_cta button:hover{background-color:"+a+"}.sbplus_wrapper #sbplus #sbplus_content_wrapper #sbplus_right_col .list .item:hover{color:"+s+";background-color:"+a+"}.sbplus_wrapper #sbplus #sbplus_content_wrapper #sbplus_right_col .list .sb_selected{color:"+s+";background-color:"+e.xml.settings.accent+"}.sbplus_wrapper #sbplus #sbplus_content_wrapper #sbplus_right_col #sbplus_table_of_contents_wrapper .section .current{border-left-color:"+e.xml.settings.accent+"}.sbplus_wrapper #sbplus #sbplus_control_bar #sbplus_right_controls #sbplus_download_btn_wrapper #sbplus_download_btn .menu-parent .menu .menu-item:hover,.sbplus_wrapper #sbplus #sbplus_control_bar #sbplus_right_controls #sbplus_download_btn_wrapper .root-level .menu-parent .menu .menu-item:hover{background-color:"+e.xml.settings.accent+"}.sbplus_wrapper #sbplus #sbplus_control_bar #sbplus_right_controls #sbplus_download_btn_wrapper #sbplus_download_btn .menu-parent .menu .menu-item:hover a,.sbplus_wrapper #sbplus #sbplus_control_bar #sbplus_right_controls #sbplus_download_btn_wrapper .root-level .menu-parent .menu .menu-item:hover a{color:"+s+"}.sbplus_wrapper #sbplus #sbplus_control_bar #sbplus_right_controls #sbplus_download_btn_wrapper #sbplus_download_btn .active, .sbplus_wrapper #sbplus #sbplus_control_bar #sbplus_right_controls #sbplus_download_btn_wrapper .root-level .active{color:"+e.xml.settings.accent+"}.sbplus_wrapper #sbplus #sbplus_control_bar #sbplus_right_controls #sbplus_download_btn_wrapper #sbplus_download_btn .menu-parent .menu .menu-item:focus,.sbplus_wrapper #sbplus #sbplus_control_bar #sbplus_right_controls #sbplus_download_btn_wrapper .root-level .menu-parent .menu .menu-item:focus{background-color:"+e.xml.settings.accent+"}.sbplus_wrapper #sbplus #sbplus_control_bar #sbplus_right_controls #sbplus_download_btn_wrapper #sbplus_download_btn .menu-parent .menu .menu-item:focus a,.sbplus_wrapper #sbplus #sbplus_control_bar #sbplus_right_controls #sbplus_download_btn_wrapper .root-level .menu-parent .menu .menu-item:focus a{color:"+s+"}.sbplus_wrapper #sbplus #sbplus_control_bar #sbplus_right_controls #sbplus_download_btn_wrapper #sbplus_download_btn .menu-parent:hover,.sbplus_wrapper #sbplus #sbplus_control_bar #sbplus_right_controls #sbplus_download_btn_wrapper .root-level .menu-parent:hover{color:"+e.xml.settings.accent+"}.sbplus_boxed #theme-decoration-bar{background-color:"+e.xml.settings.accent+"}.sbplus_wrapper #sbplus #sbplus_content_wrapper #sbplus_left_col #sbplus_media_wrapper #copyToCbBtn{color:"+s+";background-color:"+e.xml.settings.accent+"}.sbplus_wrapper #sbplus #sbplus_content_wrapper #sbplus_left_col #sbplus_media_wrapper #copyToCbBtn:hover{background-color:"+a+"}";$("head").append('<style type="text/css">'+r+"</style>")}"on"!==e.xml.settings.mathjax&&"true"!==e.xml.settings.mathjax||$.getScript("https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML",(function(){MathJax.Hub.Config({"HTML-CSS":{matchFontHeight:!0}})})),e.splashScreenRendered=!0,"on"!==e.xml.settings.analytics&&"true"!==e.xml.settings.analytics||ga("send","screenview",{screenName:e.getCourseDirectory()+" - splash"}),e.resize()}},setSplashImage:function(e){if(e){var t=this,a=new Image;a.src=e,a.addEventListener("load",(function(){a.complete&&($(t.splash.background).css("background-image","url("+a.src+")"),$(t.loadingScreen.wrapper).addClass("fadeOut").one("webkitAnimationEnd mozAnimationEnd animationend",(function(){$(this).removeClass("fadeOut").hide(),$(this).off()})))})),t.preloadPresenationImages()}},hideSplash:function(){this.presentationRendered&&$(this.splash.screen).addClass("fadeOut").one("webkitAnimationEnd mozAnimationEnd animationend",(function(){$(this).removeClass("fadeOut").hide(),$(this).off()})),$(this.splash.screen).is(":visible")&&!1!==this.presentationRendered||console.warn("hideSplash should be called after renderPresentation.")},preloadPresenationImages:function(){var e;worker=new Worker(this.manifest.sbplus_root_directory+"scripts/preload.js");var t=window.location.pathname,a=window.location.href,s=a.indexOf("?");-1!=s&&(a=a.substring(0,s)),-1!=(s=a.indexOf("#"))&&(a=a.substring(0,s));var r={php:"php/preload.php",pages:(t=t.replace("index.html",""))+"assets/pages/",url:(a=a.replace("index.html",""))+"assets/pages/"};worker.postMessage(r),worker.onmessage=function(e){e.data.forEach((function(e){let t=document.createElement("link");t.rel="prefetch",t.href=r.pages+e,t.setAttribute("aria-hidden",!0),t.style="position: fixed; width: 1px; height: 1px; opacity: 0;",document.getElementsByTagName("body")[0].appendChild(t)}))}},startPresentation:function(){var e=this;!1===this.presentationStarted&&(e.renderPresentation().promise().done((function(){e.hideSplash(),e.selectPage("0,0"),"on"!==e.xml.settings.analytics&&"true"!==e.xml.settings.analytics||(ga("send","screenview",{screenName:e.getCourseDirectory()}),e.sendToGA("PresentationStartBtn","click",e.getCourseDirectory(),0,0))})),e.presentationStarted=!0)},resumePresentation:function(){var e=this;!1===e.presentationStarted&&(e.renderPresentation().promise().done((function(){e.hideSplash(),e.selectPage(e.getStorageItem("sbplus-"+e.presentationLoc))})),e.presentationStarted=!0,"on"!==e.xml.settings.analytics&&"true"!==e.xml.settings.analytics||e.sendToGA("PresentationResumeBtn","click",e.getCourseDirectory(),0,0))},renderPresentation:function(){if(!1===this.presentationRendered){var e=this;if("1"===e.getStorageItem("sbplus-hide-widget")&&e.hideWidget(),"1"===e.getStorageItem("sbplus-hide-sidebar")&&e.hideSidebar(),$(e.layout.sbplus).blur(),$(e.banner.title).html(e.xml.setup.title),e.xml.setup.profileName?$(e.banner.author).html(e.xml.setup.profileName):$(e.banner.author).html(e.xml.setup.author),$(e.xml.sections).each((function(t){var a=$(this).attr("title"),s=$(this).find("page"),r='<div class="section">';$(e.xml.sections).length>=2&&(e.isEmpty(a)&&(a="Section "+(t+1)),r+='<div class="header">',r+='<div class="title">',r+=a+"</div>",r+='<div class="icon"><span class="icon-collapse"></span></div></div>'),r+='<ul class="list">',$.each(s,(function(a){++e.totalPages;let s=$(this).attr("type");r+='<li class="item" data-count="',r+=e.totalPages+'" data-page="'+t+","+a+'">',r+="quiz"===s?'<span class="icon-assessment"></span>':'<span class="numbering">'+e.totalPages+".</span> ",r+=$(this).attr("title")+"</li>"})),r+="</ul></div>",$(e.tableOfContents.container).append(r)})),$(e.layout.pageStatus).find("span.total").html(e.totalPages),$(e.screenReader.totalPages).html(e.totalPages),$(e.button.sidebar).on("click",e.toggleSidebar.bind(e)),$(e.button.widget).on("click",e.toggleWidget.bind(e)),e.xml.setup.author.length?$(e.button.author).on("click",(function(){e.openMenuItem("sbplus_author_profile")})):$(e.button.author).prop("disabled",!0),$(e.button.next).on("click",e.goToNextPage.bind(e)),$(e.button.prev).on("click",e.goToPreviousPage.bind(e)),$(e.xml.sections).length>=2&&$(e.tableOfContents.header).on("click",e.toggleSection.bind(e)),$(e.tableOfContents.page).on("click",e.selectPage.bind(e)),$(e.widget.segment).on("click","button",e.selectSegment.bind(e)),e.layout.mainMenu=new MenuBar($(e.button.menu)[0].id,!1),e.isEmpty(e.xml.setup.generalInfo)&&$(".sbplus_general_info").hide(),$.isEmptyObject(e.downloads))$(e.button.downloadWrapper).hide();else for(var t in e.layout.dwnldMenu=new MenuBar($(e.button.download)[0].id,!1),e.downloads)null!=e.downloads[t]&&$(e.button.downloadMenu).append('<li class="menu-item" tabindex="-1" role="menuitem" aria-live="polite"><a download="'+e.downloads[t].fileName+"."+e.downloads[t].fileFormat+'" href="'+e.downloads[t].url+'" onclick="SBPLUS.sendToGA( \''+t+"Link', 'click', '"+e.getCourseDirectory()+"', 4, 0 );\">"+e.capitalizeFirstLetter(t)+"</a></li>");return"on"!==e.xml.settings.mathjax&&"true"!==e.xml.settings.mathjax||MathJax.Hub.Queue(["Typeset",MathJax.Hub]),$("#sbplus_menu_btn .menu-parent").on("click",e.burgerBurger.bind(e)),(window.innerWidth<900||window.screen.width<=414)&&this.hideWidget(),this.presentationRendered=!0,e.resize(),$(e.layout.sbplus)}},goToNextPage:function(){var e=$(".sb_selected").data("page").split(","),t=Number(e[0]),a=Number(e[1]),s=this.xml.sections.length,r;++a>$(this.xml.sections[t]).find("page").length-1&&(++t>s-1&&(t=0),a=0),this.selectPage(t+","+a)},goToPreviousPage:function(){var e=$(".sb_selected").data("page").split(","),t=Number(e[0]),a=Number(e[1]);--a<0&&(--t<0&&(t=this.xml.sections.length-1),a=$(this.xml.sections[t]).find("page").length-1),this.selectPage(t+","+a)},updatePageStatus:function(e){$(this.layout.pageStatus).find("span.current").html(e)},toggleSidebar:function(){$(this.layout.sidebar).is(":visible")?this.hideSidebar():this.showSidebar()},hideSidebar:function(){var e=$(this.layout.media);$(this.layout.sidebar).hide(),$(this.button.sidebar).html('<span class="icon-sidebar-open"></span>'),e.removeClass("sidebar_on").addClass("sidebar_off")},showSidebar:function(){var e=$(this.layout.media);$(this.layout.sidebar).show(),$(this.button.sidebar).html('<span class="icon-sidebar-close"></span>'),e.removeClass("sidebar_off").addClass("sidebar_on")},toggleSection:function(e){var t=$(this.tableOfContents.header).length;if(t>1){var a;if(e instanceof Object)a=$(e.currentTarget);else{if(Number(e)>t-1)return!1;a=$(".header:eq("+e+")")}$(a.siblings(".list")).is(":visible")?this.closeSection(a):this.openSection(a)}},closeSection:function(e){var t=$(e.siblings(".list")),a=e.find(".icon");t.slideUp(),a.html('<span class="icon-open"></span>')},openSection:function(e){var t=$(e.siblings(".list")),a=e.find(".icon");t.slideDown(),a.html('<span class="icon-collapse"></span>')},selectPage:function(e){if($(this.splash.screen).is(":visible")&&(this.renderPresentation(),this.hideSplash(),this.presentationStarted=!0),e instanceof Object)this.targetPage=$(e.currentTarget);else if(this.targetPage=$('.item[data-page="'+e+'"]'),0===this.targetPage.length)return!1;if(!this.targetPage.hasClass("sb_selected")){var t=$(this.tableOfContents.page),a=$(this.tableOfContents.header);if(a.length>1){var s=this.targetPage.parent().siblings(".header");s.hasClass("current")||(a.removeClass("current"),s.addClass("current")),this.openSection(s)}t.removeClass("sb_selected"),this.targetPage.addClass("sb_selected"),this.getPage(this.targetPage.data("page")),this.updatePageStatus(this.targetPage.data("count")),$(this.screenReader.currentPage).html(this.targetPage.data("count")),$(this.layout.sidebar).is(":visible")&&this.updateScroll(this.targetPage[0])}},getPage:function(e){var t=(e=e.split(","))[0],a=e[1],s=$($(this.xml.sections[t]).find("page")[a]),r={xml:s,title:s.attr("title").trim(),type:s.attr("type").trim().toLowerCase()};r.number=e,"quiz"!==r.type?(r.src=s.attr("src").trim(),null!=s.attr("preventAutoplay")?r.preventAutoplay=s.attr("preventAutoplay").trim():r.preventAutoplay="false",void 0!==s.attr("useDefaultPlayer")?r.useDefaultPlayer=s.attr("useDefaultPlayer").trim():r.useDefaultPlayer="true",s.find("note").length&&(r.notes=this.getTextContent(s.find("note"))),r.widget=s.find("widget"),s.find("copyableContent").length&&(r.copyableContent=s.find("copyableContent")),r.frames=s.find("frame"),r.imageFormat=this.xml.settings.imgType,r.transition=s[0].hasAttribute("transition")?s.attr("transition").trim():"",this.currentPage=new Page(r)):this.currentPage=new Page(r,s),this.currentPage.getPageMedia(),$(this.screenReader.pageTitle).html(r.title)},updateScroll:function(e){var t=e;if($(t).is(":visible")||(t=$(t).parent().siblings(".header")[0]),"0,0"!=$(t).data("page")){var a=$(this.tableOfContents.container).height(),s=$(t).outerHeight(),r=$(this.tableOfContents.header),i=$(t).offset().top-s;r.length<=0&&(i+=40),i>a&&t.scrollIntoView({behavior:"smooth",block:"end"}),i<s&&t.scrollIntoView({behavior:"smooth"})}else $(t).parent().prev().length?$($(t).parent().prev())[0].scrollIntoView({behavior:"smooth",block:"end"}):t.scrollIntoView({behavior:"smooth",block:"end"})},openMenuItem:function(e){null!=this.currentPage.mediaPlayer&&(this.currentPage.mediaPlayer.paused()||this.currentPage.mediaPlayer.pause());var t=this,a=e,s="",r=$(this.menu.menuContentWrapper),i=$(this.menu.menuContent),n=$(this.menu.menuBarTitle);switch(i.empty(),$(t.menu.menuContentList+" li").removeClass("active"),$(t.menu.menuContentList+" ."+a).addClass("active"),a){case"sbplus_author_profile":if(n.html("Author Profile"),t.xml.setup.author.length){if(i.append('<div class="profileImg"></div>'),0===t.xml.setup.authorPhoto.length){var o=t.xml.setup.author,l=t.sanitize(o),u=t.manifest.sbplus_author_directory+l+".jpg";$.ajax({type:"HEAD",url:"assets/"+l+".jpg"}).done((function(){t.xml.setup.authorPhoto=this.url;var e='<img src="';e+=this.url+'" alt="Photo of '+o+'" crossorigin="Anonymous" />',$(".profileImg").html(e)})).fail((function(){$.ajax({type:"HEAD",url:u}).done((function(){t.xml.setup.authorPhoto=this.url;var e='<img src="';e+=this.url+'" alt="Photo of '+o+'" crossorigin="Anonymous" />',$(".profileImg").html(e)}))}))}else{var d='<img src="';d+=t.xml.setup.authorPhoto+'" alt="Photo of '+o+'" crossorigin="Anonymous" />',$(".profileImg").prepend(d)}s="object"!=typeof t.xml.setup.profile?'<p class="name">'+t.xml.setup.author+"</p>":'<p class="name">'+t.xml.setup.profile.name+"</p>",s+=t.noScript(t.xml.setup.profile)}else s="No author profile available.";break;case"sbplus_general_info":n.html("General Info"),s=t.isEmpty(t.xml.setup.generalInfo)?"No general information available.":t.xml.setup.generalInfo;break;case"sbplus_settings":n.html("Settings"),Modernizr.localstorage&&Modernizr.sessionstorage?!1===this.hasStorageItem("sbplus-"+t.presentationLoc+"-settings-loaded",!0)?$.get(t.manifest.sbplus_root_directory+"scripts/templates/settings.tpl",(function(e){t.settings=e,t.setStorageItem("sbplus-"+t.presentationLoc+"-settings-loaded",1,!0),i.append(e),t.afterSettingsLoaded()})):(i.append(t.settings),t.afterSettingsLoaded()):(s="Settings require web browser's local storage and session storage support. ",s+="Your web browser does not support local and session storage or is in private mode.");break;default:var c=t.manifest.sbplus_custom_menu_items;for(var p in c){var m;if(a==="sbplus_"+t.sanitize(c[p].name)){n.html(c[p].name),s=c[p].content;break}}break}r.show(),i.append(s),$(t.button.menuClose).on("click",t.closeMenuContent.bind(t)),"on"!==t.xml.settings.analytics&&"true"!==t.xml.settings.analytics||ga("send","screenview",{screenName:n.html()}),"on"!==t.xml.settings.mathjax&&"true"!==t.xml.settings.mathjax||MathJax.Hub.Queue(["Typeset",MathJax.Hub])},closeMenuContent:function(){var e=$(this.menu.menuContentWrapper),t;$(this.menu.menuContent).empty(),e.hide(),$(this.button.menuClose).off("click")},burgerBurger:function(){var e=$("span.menu-icon");this.clickCount++,this.clickCount===this.randomNum?(e.removeClass("icon-menu").html("🍔"),this.clickCount=0,this.randomNum=Math.floor(6*Math.random()+5)):e.addClass("icon-menu").empty()},toggleWidget:function(){
$(this.layout.widget).is(":visible")?this.hideWidget():this.showWidget()},hideWidget:function(){var e=$(this.layout.media);$(this.layout.widget).hide(),$(this.button.widget).find(".icon-widget-open").show(),$(this.button.widget).find(".icon-widget-close").hide(),e.css("height","100%"),e.removeClass("widget_on").addClass("widget_off"),this.showWidgetContentIndicator()},showWidget:function(){var e=$(this.layout.media);$(this.layout.widget).show(),$(this.button.widget).find(".icon-widget-close").show(),$(this.button.widget).find(".icon-widget-open").hide(),e.css("height",""),e.removeClass("widget_off").addClass("widget_on"),this.hideWidgetContentIndicator()},disableWidget:function(){$(this.button.widget).prop("disabled",!0).addClass("sb_disabled")},enableWidget:function(){$(this.button.widget).prop("disabled",!1).removeClass("sb_disabled")},clearWidget:function(){$(this.widget.segment).empty(),$(this.widget.content).empty()},hasWidgetContent:function(){return $(this.widget.segment).find("button").length},showWidgetContentIndicator:function(){this.hasWidgetContent()&&($(this.layout.widget).is(":visible")||$(this.button.widget).addClass("showDot"))},hideWidgetContentIndicator:function(){$(this.button.widget).removeClass("showDot")},selectSegment:function(e){var t=this,a=$(this.widget.segment).find("button");if(t.hasWidgetContent()){t.showWidgetContentIndicator(),$(t.layout.widget).removeClass("noSegments"),$(t.widget.content).css("background-image",""),$(this.screenReader.hasNotes).html("This page contains notes.");var s="",r="";"string"==typeof e?(s=$("#"+e),r=e):r=(s=$(e.currentTarget))[0].id,s.hasClass("active")||(this.currentPage.getWidgetContent(r),a.removeClass("active"),s.addClass("active")),"on"!==this.xml.settings.mathjax&&"true"!==this.xml.settings.mathjax||MathJax.Hub.Queue(["Typeset",MathJax.Hub])}else this.hideWidgetContentIndicator(),$(this.screenReader.hasNotes).empty(),$(this.layout.widget).addClass("noSegments"),t.isEmpty(t.logo)||$(t.widget.content).css("background-image","url("+t.logo+")")},selectFirstSegment:function(){var e=$(this.widget.segment).find("button")[0],t=$(e).attr("id");this.selectSegment(t)},addSegment:function(e){var t='<button id="sbplus_'+this.sanitize(e)+'">'+e+"</button>";this.widget.segments.push(e),"Notes"===e?$(this.widget.segment).prepend(t):$(this.widget.segment).append(t)},clearWidgetSegment:function(){$(this.widget.segment).empty(),$(this.widget.content).empty(),$(this.widget.bg).css("background-image",""),this.widget.segments=[]},checkForSupport:function(){return Modernizr.video&&Modernizr.eventlistener&&Modernizr.json&&Modernizr.flexbox&&Modernizr.flexwrap&&Modernizr.csscalc?1:0},showErrorScreen:function(e){if(this.hasError&&e.length){var t=this.manifest.sbplus_root_directory;switch($(this.layout.sbplus).hide(),e){case"support":t+="scripts/templates/support_error.tpl";break;case"xml":t+="scripts/templates/xml_error.tpl";break;case"parser":t+="scripts/templates/xml_parse_error.tpl";break;default:t="";break}if(t.length){var a=this;$.get(t,(function(e){$(a.layout.errorScreen).html(e).show().addClass("shake").css("display","flex")}))}}},calcLayout:function(){var e=$(this.layout.widget),t=$(this.layout.sidebar),a=$(this.tableOfContents.container),s=$(this.button.widgetTip);if(window.innerWidth<900||window.screen.width<=414){this.layout.isMobile=!0,s.show();var r=$(this.layout.leftCol).height()+$(this.layout.mainControl).height();t.css("height","calc( 100% - "+r+"px )"),e.css("height",t.height()),a.css("height",t.height()-30),!1===this.alreadyResized&&this.hideWidget(),this.alreadyResized=!0,$(this.layout.wrapper).removeClass("sbplus_boxed")}else this.layout.isMobile=!1,t.css("height",""),e.css("height",""),a.css("height",""),s.hide(),"1"!==this.getUrlParam("fullview")&&$(this.layout.wrapper).addClass("sbplus_boxed")},resize:function(){this.calcLayout(),this.layout.isMobile&&this.showSidebar()},setURLOptions:function(){var e=$(this.layout.html),t=$(this.layout.wrapper);"1"===this.getUrlParam("fullview")?(e.addClass("sbplus_pop_full"),t.removeClass("sbplus_boxed").addClass("sbplus_full")):(e.removeClass(".sbplus_pop_full"),t.addClass("sbplus_boxed").removeClass("sbplus_full"))},getUrlParam:function(e){var t=new RegExp("[?&]"+e+"=([^&#]*)").exec(window.location.href);return null===t?null:t[1]||0},getManifestUrl:function(){var e=$("#sbplus_configs");return e.length?e[0].href:""},sanitize:function(e){return e.replace(/[^\w]/gi,"").toLowerCase()},capitalizeFirstLetter:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},trimAndLower:function(e){return e.trim().toLowerCase()},isEmpty:function(e){return null==e||!e.trim()||0===e.trim().length},colorLum:function(e,t){(e=String(e).replace(/[^0-9a-f]/gi,"")).length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),t=t||0;var a="#",s,r;for(r=0;r<3;r++)s=parseInt(e.substr(2*r,2),16),a+=("00"+(s=Math.round(Math.min(Math.max(0,s+s*t),255)).toString(16))).substr(s.length);return a},colorContrast:function(e){return(e=parseInt(e.slice(1),15))>8388607.5?"#000":"#fff"},noScript:function(e){if(""!==e||void 0!==e){var t=$("<span>"+$.trim(e)+"</span>");return t.find("script,noscript,style").remove().end(),t.html()}return e},noCDATA:function(e){return void 0===e||""===e?"":e.replace(/<!\[CDATA\[/g,"").replace(/\]\]>/g,"").trim()},hexToRgb:function(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,(function(e,t,a,s){return t+t+a+a+s+s}));var a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return a?parseInt(a[1],16)+","+parseInt(a[2],16)+","+parseInt(a[3],16):null},getProgramDirectory:function(){var e=this.getUrlArray();return e.length>=3?e[e.length-3]:2===e.length?e[0]:""},getCourseDirectory:function(){var e=this.getUrlArray();return e.length>=2?e[e.length-1]:"default"},getUrlArray:function(){var e=window.location.href,t=e;e.indexOf("?")&&(t=(e=e.split("?"))[0]);var a=t.split("/");return a.splice(0,1),a[a.length-1].indexOf(".")>=0&&a.splice(a.length-1,1),this.removeEmptyElements(a)},removeEmptyElements:function(e){for(var t=!1,a=0;a<e.length;a++)SBPLUS.isEmpty(e[a])&&(t=!0),e[a].match(/^[0-9]+$/m)&&(t=!0),t&&(e.splice(a,1),t=!1);return e},setStorageItem:function(e,t,a){(Modernizr.localstorage||Modernizr.sessionstorage)&&(a?sessionStorage.setItem(e,t):localStorage.setItem(e,t))},getStorageItem:function(e,t){if(Modernizr.localstorage||Modernizr.sessionstorage)return t?sessionStorage.getItem(e):localStorage.getItem(e)},deleteStorageItem:function(e,t){if(Modernizr.localstorage||Modernizr.sessionstorage)return t?sessionStorage.removeItem(e):localStorage.removeItem(e)},hasStorageItem:function(e,t){if(Modernizr.localstorage||Modernizr.sessionstorage)return t?!this.isEmpty(sessionStorage.getItem(e)):!this.isEmpty(localStorage.getItem(e))},removeAllSessionStorage:function(){if(Modernizr.sessionstorage)return sessionStorage.clear()},getTextContent:function(e){var t=e.html();if(void 0===t){if(this.isEmpty(e[0].textContent))return"";var a=document.createElement("div");a.appendChild(e[0]);var s=new RegExp("<"+a.firstChild.nodeName+'?\\s*([A-Za-z]*=")*[A-Za-z\\s]*"*>',"gi"),r=new RegExp("</"+a.firstChild.nodeName+">","gi");t=(t=a.innerHTML).replace(s,"").replace(r,"").replace(/&lt;/g,"<").replace(/&gt;/g,">").trim()}return this.noScript(this.noCDATA(t))},isIOSDevice:function(){return!(!(/iPad|iPhone|iPod/.test(navigator.platform)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1)||window.MSStream)},afterSettingsLoaded:function(){var e=this;"1"===e.getStorageItem("sbplus-"+e.presentationLoc+"-settings-loaded",!0)&&(e.isIOSDevice()&&($("#autoplay_label").after('<p class="error">Mobile devices do not support autoplay.</p>'),$("#sbplus_va_autoplay").prop("checked",!1).attr("disabled",!0)),e.syncSettings(),$(".settings input, .settings select").on("change",(function(){$(e.menu.menuSavingMsg).fadeIn().html("Saving..."),$("#sbplus_gs_widget").is(":checked")?e.setStorageItem("sbplus-hide-widget",1):e.setStorageItem("sbplus-hide-widget",0),$("#sbplus_gs_sidebar").is(":checked")?e.setStorageItem("sbplus-hide-sidebar",1):e.setStorageItem("sbplus-hide-sidebar",0),$("#sbplus_va_autoplay").is(":checked")?(e.setStorageItem("sbplus-autoplay",1),$(e.layout.wrapper).addClass("sbplus_autoplay_on")):(e.setStorageItem("sbplus-autoplay",0),$(e.layout.wrapper).removeClass("sbplus_autoplay_on")),$("#sbplus_va_subtitle").is(":checked")?e.setStorageItem("sbplus-subtitle",1):e.setStorageItem("sbplus-subtitle",0);var t=$("#sbplus_va_volume").val(),a=!1;t<0||t>100||e.isEmpty(t)?(a=!0,t=100*Number(e.getStorageItem("sbplus-volume"))):(e.setStorageItem("sbplus-volume",t/100),e.setStorageItem("sbplus-"+e.presentationLoc+"-volume-temp",t/100,!0)),a?$("#volume_label").after('<p class="error">Value must be between 0 and 100.</p>'):$("#volume_label").next(".error").remove(),e.setStorageItem("sbplus-playbackrate",$("#sbplus_va_playbackrate option:selected").val()),e.setStorageItem("sbplus-"+e.presentationLoc+"-playbackrate-temp",$("#sbplus_va_playbackrate option:selected").val(),!0),$(e.menu.menuSavingMsg).html("Settings saved!"),setTimeout((function(){$(e.menu.menuSavingMsg).fadeOut("slow",(function(){$(this).empty()}))}),1500)})))},syncSettings:function(){var e=this;if("1"===e.getStorageItem("sbplus-"+e.presentationLoc+"-settings-loaded",!0)){var t,a,s;"1"===e.getStorageItem("sbplus-hide-widget")?$("#sbplus_gs_widget").prop("checked",!0):$("#sbplus_gs_widget").prop("checked",!1),"1"===e.getStorageItem("sbplus-hide-sidebar")?$("#sbplus_gs_sidebar").prop("checked",!0):$("#sbplus_gs_sidebar").prop("checked",!1),"1"===e.getStorageItem("sbplus-disable-it")?$("#sbplus_gs_it").prop("checked",!0):$("#sbplus_gs_it").prop("checked",!1);var r=e.getStorageItem("sbplus-autoplay");!1===e.isIOSDevice()&&("1"===r?$("#sbplus_va_autoplay").prop("checked",!0):$("#sbplus_va_autoplay").prop("checked",!1));var i=e.getStorageItem("sbplus-volume");$("#sbplus_va_volume").prop("value",100*i);var n=e.getStorageItem("sbplus-playbackrate"),o;$("#sbplus_va_playbackrate").val(n),"1"===e.getStorageItem("sbplus-subtitle")?$("#sbplus_va_subtitle").prop("checked",!0):$("#sbplus_va_subtitle").prop("checked",!1)}},sendToGA:function(e,t,a,s,r){if("on"===this.xml.settings.analytics||"true"===this.xml.settings.analytics){var i=this,n=0,o=!1;"object"==typeof r?(n=1e3*r.start,o=!0):n=1e3*r,window.ga&&ga.loaded&&(i.gaTimeouts.start=setTimeout((function(){ga("send","event",e,t,a,s,{screenName:i.getCourseDirectory()})}),n),o&&(r.halfway>0&&r.halfway>r.start&&(i.gaTimeouts.halfway=setTimeout((function(){ga("send","event",e,"halfway",a,2,{screenName:i.getCourseDirectory()})}),1e3*r.halfway)),r.completed>0&&r.completed>r.halfway&&(i.gaTimeouts.completed=setTimeout((function(){ga("send","event",e,"completed",a,3,{screenName:i.getCourseDirectory()})}),1e3*r.completed))))}},clearGATimeout:function(){if("on"===this.xml.settings.analytics){var e=this;null!==e.gaTimeouts.start&&clearTimeout(e.gaTimeouts.start),null!==e.gaTimeouts.halfway&&clearTimeout(e.gaTimeouts.halfway),null!==e.gaTimeouts.completed&&clearTimeout(e.gaTimeouts.completed)}}};$((function(){SBPLUS.go()}));var Page=function(e,t){this.pageXML=e.xml[0],this.pageData=t,this.title=e.title,this.type=e.type,this.transition=e.transition,this.pageNumber=e.number,this.gaEventCate="",this.gaEventLabel="",this.gaEventAction="",this.gaEventValue=-1,this.gaEventHalfway=!1,this.gaDelays={start:0,halfway:0,completed:0},"quiz"!==e.type&&(this.src=e.src,this.preventAutoplay=e.preventAutoplay,this.useDefaultPlayer=e.useDefaultPlayer,this.notes=e.notes,this.widget=e.widget,this.widgetSegments={},this.copyableContent=e.copyableContent,this.imgType=e.imageFormat,e.frames.length&&(this.frames=e.frames,this.cuepoints=[]),this.mediaPlayer=null,this.isKaltura=null,this.isAudio=!1,this.isVideo=!1,this.isYoutube=!1,this.isVimeo=!1,this.isBundle=!1,this.isPlaying=!1,this.captionUrl="",this.transcript=null,this.transcriptLoaded=!1,this.hasImage=!1,this.missingImgUrl="",this.delayStorage=null),this.root=SBPLUS.manifest.sbplus_root_directory,this.kaltura={id:SBPLUS.manifest.sbplus_kaltura.id,flavors:{low:SBPLUS.manifest.sbplus_kaltura.low,normal:SBPLUS.manifest.sbplus_kaltura.normal,medium:SBPLUS.manifest.sbplus_kaltura.medium}},this.kalturaSrc={},this.leftCol=SBPLUS.layout.leftCol,this.mediaContent=SBPLUS.layout.mediaContent,this.quizContainer=SBPLUS.layout.quizContainer,this.mediaError=SBPLUS.layout.mediaError};Page.prototype.getPageMedia=function(){var e=this;switch($(SBPLUS.layout.quizContainer).length&&$(SBPLUS.layout.quizContainer).remove(),$(e.mediaContent).css("backgroundImage","").removeClass("compat-object-fit").removeClass("show-vjs-poster"),$(this.mediaError).empty().hide(),$("#mp").length&&videojs("mp").dispose(),SBPLUS.clearWidget(),SBPLUS.enableWidget(),$(e.mediaContent).removeClass("iframeEmbed").empty(),SBPLUS.hasStorageItem("sbplus-"+SBPLUS.presentationLoc+"-previously-widget-open",!0)&&("1"===SBPLUS.getStorageItem("sbplus-"+SBPLUS.presentationLoc+"-previously-widget-open",!0)&&SBPLUS.showWidget(),SBPLUS.deleteStorageItem("sbplus-"+SBPLUS.presentationLoc+"-previously-widget-open",!0)),e.gaEventHalfway=!1,SBPLUS.clearGATimeout(),$(SBPLUS.layout.mediaMsg).addClass("hide").html(""),e.showCopyBtn(),e.type){case"kaltura":!1===SBPLUS.kalturaLoaded?$.getScript(e.root+"scripts/libs/kaltura/mwembedloader.js",(function(){$.getScript(e.root+"scripts/libs/kaltura/kwidgetgetsources.js",(function(){SBPLUS.kalturaLoaded=!0,e.loadKalturaVideoData()}))})):e.loadKalturaVideoData(),e.gaEventCate="Video",e.gaEventLabel=SBPLUS.getCourseDirectory()+":kaltura:page"+SBPLUS.targetPage.data("count"),e.gaEventAction="start",e.gaEventValue=3,e.gaDelays.start=6;break;case"image-audio":e.isAudio=!0,$.ajax({url:"assets/pages/"+e.src+"."+e.imgType,type:"HEAD"}).done((function(){e.hasImage=!0})).fail((function(){e.showPageError("NO_IMG",this.url),e.missingImgUrl=this.url})).always((function(){$.ajax({url:"assets/audio/"+e.src+".vtt",type:"HEAD"}).done((function(t){e.captionUrl=this.url,e.transcript=SBPLUS.noScript(t)})).always((function(){var t='<video id="mp" class="video-js vjs-default-skin"></video>';$(e.mediaContent).addClass("show-vjs-poster"),$(e.mediaContent).html(t).promise().done((function(){e.renderVideoJS(),e.setWidgets()}))}))})),e.gaEventCate="Audio",e.gaEventLabel=SBPLUS.getCourseDirectory()+":audio:page"+SBPLUS.targetPage.data("count"),e.gaEventAction="start",e.gaEventValue=2,e.gaDelays.start=6;break;case"image":var t=new Image;t.src="assets/pages/"+e.src+"."+e.imgType,t.alt=e.title,$(t).on("load",(function(){e.hasImage=!0,Modernizr.objectfit||$(".sbplus_media_content").each((function(){var e=$(this),t=e.find("img").prop("src");t&&e.css("backgroundImage","url("+t+")").addClass("compat-object-fit")}))})),$(t).on("error",(function(){e.hasImage=!1,e.showPageError("NO_IMG",t.src)})),$(e.mediaContent).html('<img src="'+t.src+'" class="img_only" alt="'+t.alt+'" />').promise().done((function(){e.setWidgets()})),e.gaEventCate="Image",e.gaEventLabel=SBPLUS.getCourseDirectory()+":image:page"+SBPLUS.targetPage.data("count"),e.gaEventAction="start",e.gaEventValue=4,e.gaDelays.start=10,e.gaDelays.halfway=30,e.gaDelays.completed=60;break;case"video":$.ajax({url:"assets/video/"+e.src+".vtt",type:"HEAD"}).done((function(t){e.captionUrl=this.url,e.transcript=SBPLUS.noScript(t)})).always((function(){var t='<video id="mp" class="video-js vjs-default-skin" crossorigin="anonymous" width="100%" height="100%"></video>';$(e.mediaContent).html(t).promise().done((function(){e.isVideo=!0,e.renderVideoJS(),e.setWidgets()}))})),e.gaEventCate="Video",e.gaEventLabel=SBPLUS.getCourseDirectory()+":video:page"+SBPLUS.targetPage.data("count"),e.gaEventAction="start",e.gaEventValue=3,e.gaDelays.start=6;break;case"youtube":if(e.isYoutube=!0,"true"===e.useDefaultPlayer||"yes"===e.useDefaultPlayer)$(e.mediaContent).html('<video id="mp" class="video-js vjs-default-skin"></video>').promise().done((function(){e.renderVideoJS()}));else{var a="false"===e.preventAutoplay||"no"===e.preventAutoplay?1:0;$(e.mediaContent).html('<iframe width="100%" height="100%" src="https://www.youtube-nocookie.com/embed/'+e.src+"?autoplay="+a+'&playsinline=1&modestbranding=1&disablekb=1" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"></iframe>')}e.setWidgets(),e.gaEventCate="Video",e.gaEventLabel=SBPLUS.getCourseDirectory()+":youtube:page"+SBPLUS.targetPage.data("count"),e.gaEventAction="start",e.gaEventValue=3,e.gaDelays.start=6;break;case"vimeo":$(e.mediaContent).html('<video id="mp" class="video-js vjs-default-skin"></video>').promise().done((function(){e.isVimeo=!0,e.renderVideoJS(),e.setWidgets()})),e.gaEventCate="Video",e.gaEventLabel=SBPLUS.getCourseDirectory()+":vimeo:page"+SBPLUS.targetPage.data("count"),e.gaEventAction="start",e.gaEventValue=3,e.gaDelays.start=6;break;case"bundle":$(e.frames).each((function(){var t=toSeconds($(this).attr("start"));e.cuepoints.push(t)})),$.ajax({url:"assets/audio/"+e.src+".vtt",type:"HEAD"}).done((function(t){e.captionUrl=this.url,e.transcript=SBPLUS.noScript(t)})).always((function(){var t='<video id="mp" class="video-js vjs-default-skin"></video>';$(e.mediaContent).addClass("show-vjs-poster"),$(e.mediaContent).html(t).promise().done((function(){e.isBundle=!0,e.renderVideoJS(),e.setWidgets()}))})),e.gaEventCate="Audio",e.gaEventLabel=SBPLUS.getCourseDirectory()+":bundle:page"+SBPLUS.targetPage.data("count"),e.gaEventAction="start",e.gaEventValue=2,e.gaDelays.start=6;break;case"quiz":$(e.leftCol).append('<div id="sbplus_quiz_wrapper"></div>').promise().done((function(){var t={id:e.pageNumber},a;new Quiz(t,e.pageData).getQuiz(),$("#sbplus_widget").is(":visible")&&SBPLUS.setStorageItem("sbplus-"+SBPLUS.presentationLoc+"-previously-widget-open",1,!0),SBPLUS.hideWidget(),SBPLUS.disableWidget()})),e.gaEventCate="Quiz",e.gaEventLabel=SBPLUS.getCourseDirectory()+":quiz:page"+SBPLUS.targetPage.data("count"),e.gaEventAction="start",e.gaEventValue=5,e.gaDelays.start=10,e.gaDelays.halfway=30;break;case"html":var s=!1,r=!1,i=e.src;if(isUrl(i)||(i="assets/html/"+e.src),void 0!==$(e.pageXML).attr("embed")&&(s=$(e.pageXML).attr("embed").toLowerCase()),$(e.pageXML).find("audio").length>=1&&(r=$($(e.pageXML).find("audio")[0]).attr("src").toLowerCase()),"yes"===s||"true"===s){var n='<iframe id="iframeWithAudio" class="html" src="'+i+'"></iframe>';if($(e.mediaContent).addClass("iframeEmbed"),r.length){var o='<video id="mp" class="video-js vjs-default-skin"></video>';e.isAudio=!0,$(e.mediaContent).append(o),e.renderVideoJS(r),$(".video-js").prepend(n)}else $(e.mediaContent).html(n)}else{var l='<div class="html exLink">';l+="<small>click the link to open it in a new tab/window</small>",l+='<a href="'+i+'" target="_blank">'+i+"</a>",l+="</div>",$(e.mediaContent).addClass("html").html(l),window.open(i,"_blank")}e.setWidgets(),e.gaEventCate="HTML",e.gaEventLabel=SBPLUS.getCourseDirectory()+":html:page"+SBPLUS.targetPage.data("count"),e.gaEventAction="start",e.gaEventValue=6,e.gaDelays.start=10,e.gaDelays.halfway=30,e.gaDelays.completed=60;break;default:e.showPageError("UNKNOWN_TYPE",e.type),e.setWidgets();break}"image"!==e.type&&"html"!==e.type||$(e.mediaContent).addClass(e.transition).one("webkitAnimationEnd mozAnimationEnd animationend",(function(){$(this).removeClass(e.transition),$(this).off()})),window.clearTimeout(e.delayStorage),e.delayStorage=window.setTimeout((function(){var t=SBPLUS.sanitize(SBPLUS.getCourseDirectory()),a=e.pageNumber[0]+","+e.pageNumber[1];"0,0"!==a?SBPLUS.setStorageItem("sbplus-"+t,a):SBPLUS.deleteStorageItem("sbplus-"+t)}),3e3),""!==e.gaEventCate&&SBPLUS.sendToGA(e.gaEventCate,e.gaEventAction,e.gaEventLabel,e.gaEventValue,e.gaDelays)},Page.prototype.showCopyBtn=function(){if(this.removeCopyBtn(),this.copyableContent){const e=document.createElement("button");e.id="copyToCbBtn";const t=document.createElement("span");t.classList.add("btn-txt"),SBPLUS.isEmpty($(this.copyableContent).attr("name"))?t.innerHTML="Copy to Clipboard":t.innerHTML=$(this.copyableContent).attr("name"),e.append(t);const a=document.createElement("textarea");a.id="copyableTxt",a.readOnly=!0,a.innerHTML=this.copyableContent[0].textContent,a.setAttribute("aria-hidden",!0),$(SBPLUS.layout.media).prepend(e),$(SBPLUS.layout.media).prepend(a),$(SBPLUS.layout.media).on("click","#copyToCbBtn",copyToClipboard)}},Page.prototype.removeCopyBtn=function(){const e=document.getElementById("copyToCbBtn"),t=document.getElementById("copyableTxt");e&&t&&(e.parentNode.removeChild(e),t.parentNode.removeChild(t),$(SBPLUS.layout.media).off("click","#copyToCbBtn",copyToClipboard))},Page.prototype.loadKalturaVideoData=function(){var e=this;e.isKaltura={flavors:{},status:{entry:0,low:0,normal:0,medium:0},duration:""},kWidget.getSources({partnerId:e.kaltura.id,entryId:e.src,callback:function(t){var a=t.caption;for(var s in e.isKaltura.status.entry=t.status,e.isKaltura.duration=t.duration,e.isKaltura.poster=t.poster,t.sources){var r=t.sources[s];r.flavorParamsId===e.kaltura.flavors.low&&(e.isKaltura.flavors.low=r.src,e.isKaltura.status.low=r.status),r.flavorParamsId===e.kaltura.flavors.normal&&(e.isKaltura.flavors.normal=r.src,e.isKaltura.status.normal=r.status),r.flavorParamsId===e.kaltura.flavors.medium&&(e.isKaltura.flavors.medium=r.src,e.isKaltura.status.medium=r.status)}if(e.isKaltura.status.entry>=1&&e.isKaltura.status.entry<=2){if(e.isKaltura.status.entry>=1&&e.isKaltura.status.entry<=2)if(2===e.isKaltura.status.normal||4===e.isKaltura.status.normal){null!==a&&(e.captionUrl=[],a.forEach((t=>{"English (autocaption)"!=t.label.toLowerCase()&&e.captionUrl.push({kinds:"captions",language:t.languageCode,label:t.language,url:"https://www.kaltura.com/api_v3/?service=caption_captionasset&action=servewebvtt&captionAssetId="+t.id+"&segmentDuration="+e.isKaltura.duration+"&segmentIndex=1"})})));var i='<video id="mp" class="video-js vjs-default-skin" crossorigin="anonymous" width="100%" height="100%"></video>';$(e.mediaContent).html(i).promise().done((function(){e.renderVideoJS()}))}else e.showPageError("KAL_NOT_READY");else e.showPageError("KAL_ENTRY_NOT_READY");e.setWidgets()}}})},Page.prototype.renderVideoJS=function(e){var t=this,a={play:!1,replay:!1,playReached25:!1,playReached50:!1,playReached75:!1,playReached100:!1};e=void 0!==e?e:t.src;var s=!0;"0"===SBPLUS.getStorageItem("sbplus-autoplay")&&(s=!1),"true"===t.preventAutoplay?(s=!1,$(SBPLUS.layout.wrapper).addClass("preventAutoplay")):$(SBPLUS.layout.wrapper).removeClass("preventAutoplay");var r={techOrder:["html5"],controls:!0,autoplay:s,preload:"auto",playbackRates:[.5,1,1.5,2],controlBar:{fullscreenToggle:!1},plugins:{replayButton:!0}},i;(SBPLUS.isIOSDevice()&&(r.autoplay=!1,r.playsinline=!0,r.nativeControlsForTouch=!1),t.isKaltura?$.extend(r.plugins,{videoJsResolutionSwitcher:{default:720}}):t.isYoutube?(r.techOrder=["youtube"],r.sources=[{type:"video/youtube",src:"https://www.youtube.com/watch?v="+e+"&modestbranding=1"}],r.playbackRates=null,$.extend(r.plugins,{videoJsResolutionSwitcher:{default:720}})):t.isVimeo&&(r.techOrder=["vimeo"],r.sources=[{type:"video/vimeo",src:"https://vimeo.com/"+e}],r.playbackRates=null),t.mediaPlayer=videojs("mp",r,(function(){var i=this;if(t.isKaltura&&(!1===s&&i.poster(t.isKaltura.poster+"/width/900/quality/100"),i.updateSrc([{src:t.isKaltura.flavors.low,type:"video/mp4",label:"low",res:360},{src:t.isKaltura.flavors.normal,type:"video/mp4",label:"normal",res:720},{src:t.isKaltura.flavors.medium,type:"video/mp4",label:"medium",res:640}])),t.isAudio||t.isBundle){if(t.isAudio&&t.hasImage&&i.poster("assets/pages/"+e+"."+t.imgType),t.isBundle){var n=0,o=new Image;i.on("loadedmetadata",(function(){n=Math.floor(i.duration())})),i.cuepoints(),i.addCuepoint({namespace:e+"-1",start:0,end:t.cuepoints[0],onStart:function(){o.src="assets/pages/"+e+"-1."+t.imgType,$(".vjs-poster")[0].innerHTML="<img src="+o.src+" />",i.poster(o.src)},onEnd:function(){},params:""}),$.each(t.cuepoints,(function(a){var s;s=void 0===t.cuepoints[a+1]?n:t.cuepoints[a+1],i.addCuepoint({namespace:e+"-"+(a+2),start:t.cuepoints[a],end:s,onStart:function(){o.src="assets/pages/"+e+"-"+(a+2)+"."+t.imgType,$(o).on("error",(function(){t.showPageError("NO_IMG",o.src)}));var s=$(".vjs-poster")[0],r=document.createElement("img");r.src=o.src,$(s).append(r),$(r).hide().fadeIn(250),i.poster(o.src)}})})),i.on("seeking",(function(){$(".vjs-poster")[0].innerHTML="",i.currentTime()<=t.cuepoints[0]&&i.poster("assets/pages/"+e+"-1."+t.imgType)}))}i.src({type:"audio/mp3",src:"assets/audio/"+e+".mp3"})}t.isVideo&&i.src({type:"video/mp4",src:"assets/video/"+e+".mp4"}),t.isKaltura?t.captionUrl.length&&t.captionUrl.forEach((e=>{i.addRemoteTextTrack({kind:e.kind,language:e.language,label:e.label,src:e.url},!0)})):t.captionUrl&&i.addRemoteTextTrack({kind:"captions",language:"en",label:"English",src:t.captionUrl},!0),t.isYoutube&&t.useDefaultPlayer&&$.ajax({url:"assets/video/yt-"+e+".vtt",type:"HEAD"}).done((function(){i.addRemoteTextTrack({kind:"captions",language:"en",label:"English",src:"assets/video/yt-"+e+".vtt"},!0)})),null!==r.playbackRates&&i.playbackRate(SBPLUS.playbackrate),i.on(["waiting","pause"],(function(){t.isPlaying=!1})),i.on("loadedmetadata",(function(){t.isKaltura&&sendKAnalytics(2,t.kaltura.id,t.src,i.duration())})),i.on("play",(function(){$(SBPLUS.layout.mediaMsg).is(":visible")&&$(SBPLUS.layout.mediaMsg).addClass("hide").html("")})),i.on("playing",(function(){t.isPlaying=!0,t.isKaltura&&!1===a.play&&!1===a.replay&&(a.play=!0,sendKAnalytics(3,t.kaltura.id,t.src,i.duration())),t.isKaltura&&a.replay&&(a.replay=!1,sendKAnalytics(16,t.kaltura.id,t.src,i.duration()))})),i.on("timeupdate",(function(){if(t.isKaltura&&t.isPlaying){var e=i.currentTime()/i.duration();e>.25&&!1===a.playReached25&&(a.playReached25=!0,sendKAnalytics(4,t.kaltura.id,t.src,i.duration())),e>.5&&!1===a.playReached50&&(a.playReached50=!0,sendKAnalytics(5,t.kaltura.id,t.src,i.duration())),e>.75&&!1===a.playReached75&&(a.playReached75=!0,sendKAnalytics(6,t.kaltura.id,t.src,i.duration()))}})),i.on("ended",(function(){t.isPlaying=!1,t.isKaltura&&!1===a.playReached100&&(a.playReached100=!0,sendKAnalytics(7,t.kaltura.id,t.src,i.duration())),t.isKaltura&&!1===a.replay&&(a.replay=!0),""!==t.gaEventCate&&SBPLUS.sendToGA(t.gaEventCate,"completed",t.gaEventLabel,3,0)})),"on"===SBPLUS.xml.settings.analytics&&i.on("timeupdate",(function(){var e=i.currentTime()/i.duration()*100;""!==t.gaEventCate&&e>=50&&!1===t.gaEventHalfway&&(SBPLUS.sendToGA(t.gaEventCate,"halfway",t.gaEventLabel,2,0),t.gaEventHalfway=!0)})),i.on("error",(function(){t.showPageError("NO_MEDIA",i.src())})),i.on("resolutionchange",(function(){i.playbackRate(SBPLUS.playbackrate)})),i.on("ratechange",(function(){var e=this.playbackRate();SBPLUS.playbackrate!==e&&(SBPLUS.playbackrate=e,this.playbackRate(e))})),SBPLUS.hasStorageItem("sbplus-"+SBPLUS.presentationLoc+"-volume-temp",!0)?i.volume(Number(SBPLUS.getStorageItem("sbplus-"+SBPLUS.presentationLoc+"-volume-temp",!0))):i.volume(Number(SBPLUS.getStorageItem("sbplus-volume"))),i.on("volumechange",(function(){SBPLUS.setStorageItem("sbplus-"+SBPLUS.presentationLoc+"-volume-temp",this.volume(),!0)})),!1===t.isYoutube&&!1===t.isVimeo&&i.textTracks().tracks_.length>=1&&(SBPLUS.hasStorageItem("sbplus-"+SBPLUS.presentationLoc+"-subtitle-temp",!0)?"1"===SBPLUS.getStorageItem("sbplus-"+SBPLUS.presentationLoc+"-subtitle-temp",!0)?i.textTracks().tracks_[0].mode="showing":i.textTracks().tracks_[0].mode="disabled":"1"===SBPLUS.getStorageItem("sbplus-subtitle")?i.textTracks().tracks_[0].mode="showing":i.textTracks().tracks_[0].mode="disabled",i.textTracks().addEventListener("change",(function(){var e=this.tracks_;$.each(e,(function(){"showing"===this.mode?SBPLUS.setStorageItem("sbplus-"+SBPLUS.presentationLoc+"-subtitle-temp",1,!0):SBPLUS.setStorageItem("sbplus-"+SBPLUS.presentationLoc+"-subtitle-temp",0,!0)}))}))),addForwardButton(i),addBackwardButton(i)})),$("#mp_html5_api").length&&$("#mp_html5_api").addClass("animated "+t.transition).one("webkitAnimationEnd mozAnimationEnd animationend",(function(){$(this).removeClass("animated "+t.transition),$(this).off()})),$("#mp_Youtube_api").length)&&$("#mp_Youtube_api").parent().addClass("animated "+t.transition).one("webkitAnimationEnd mozAnimationEnd animationend",(function(){$(this).removeClass("animated "+t.transition),$(this).off()}))},Page.prototype.setWidgets=function(){var e=this;if(SBPLUS.clearWidgetSegment(),"quiz"!=this.type){var t;if(SBPLUS.isEmpty(this.notes)||SBPLUS.addSegment("Notes"),"0"===SBPLUS.getStorageItem("sbplus-disable-it")&&((e.isAudio||e.isVideo||e.isBundle)&&(SBPLUS.isEmpty(e.transcript)||SBPLUS.addSegment("Interactive Transcript (alpha)")),e.isKaltura&&(SBPLUS.isEmpty(e.captionUrl)||SBPLUS.addSegment("Interactive Transcript (alpha)"))),this.widget.length)$($(this.widget).find("segment")).each((function(){var t=$(this).attr("name"),a="sbplus_"+SBPLUS.sanitize(t);e.widgetSegments[a]=SBPLUS.getTextContent($(this)),SBPLUS.addSegment(t)}));SBPLUS.selectFirstSegment()}},Page.prototype.getWidgetContent=function(e){var t=this;switch(e){case"sbplus_notes":displayWidgetContent(this.notes);break;case"sbplus_interactivetranscriptalpha":"0"===SBPLUS.getStorageItem("sbplus-disable-it")&&(t.isAudio||t.isVideo?(displayWidgetContent(parseTranscript(t.transcript)),t.startInteractiveTranscript()):!1===t.transcriptLoaded?$.get(t.captionUrl,(function(e){t.transcriptLoaded=!0,t.transcript=parseTranscript(SBPLUS.noScript(e)),displayWidgetContent(t.transcript),t.startInteractiveTranscript()})):(displayWidgetContent(t.transcript),t.startInteractiveTranscript()));break;default:displayWidgetContent(t.widgetSegments[e]);break}},Page.prototype.showPageError=function(e,t){t=void 0!==t?t:"";var a=this,s="";switch(e){case"NO_IMG":s="<p><strong>The content for this Storybook Page could not be loaded.</strong></p><p><strong>Expected image:</strong> "+t+'</p><p>Please try refreshing your browser, or coming back later.</p><p>If this problem continues, please <a href="javascript:void(0);" onclick="SBPLUS.openMenuItem(\'sbplus_help\');">contact tech support</a>.</p>';break;case"KAL_NOT_READY":s="<p>The video for this Storybook Page is still processing and could not be loaded at the moment. Please try again later. Contact support if you continue to have issues.</p><p><strong>Expected video source</strong>: Kaltura video ID  "+a.src+"<br><strong>Status</strong>:<br>",s+="Low &mdash; "+getKalturaStatus(a.isKaltura.status.low)+"<br>",s+="Normal &mdash; "+getKalturaStatus(a.isKaltura.status.normal)+"<br>",s+="Medium &mdash; "+getKalturaStatus(a.isKaltura.status.medium)+"</p>";break;case"KAL_ENTRY_NOT_READY":s="<p>The video for this Storybook Page is still processing and could not be loaded at the moment. Please try again later. Contact support if you continue to have issues.</p><p><strong>Expected video source</strong>: Kaltura video ID "+a.src+"<br><strong>Status</strong>: ",s+=getEntryKalturaStatus(a.isKaltura.status.entry)+"</p>";break;case"NO_MEDIA":s="<p><strong>The content for this Storybook Page could not be loaded.</strong></p>",!1===a.hasImage?(s+="<p><strong>Expected audio:</strong> "+t+"<br>",s+="<strong>Expected image:</strong> "+a.missingImgUrl+"</p>"):s+="<p><strong>Expected media:</strong> "+t+"</p>",s+='<p>Please try refreshing your browser, or coming back later.</p><p>If this problem continues, please <a href="javascript:void(0);" onclick="SBPLUS.openMenuItem(\'sbplus_help\');">contact tech support</a>.</p>';break;case"UNKNOWN_TYPE":s='<p><strong>UNKNOWN PAGE TYPE</strong></p><p>Page type ("'+t+'") is not supported.</p><p>If this problem continues, please <a href="javascript:void(0);" onclick="SBPLUS.openMenuItem(\'sbplus_help\');">contact tech support</a>.</p>';break}$(a.mediaError).html(s).show()};var quizTracker=[],Quiz=function(e,t){var a=this,s=t,r=Number(e.id.join().replace(",","")),i=s.children()[0].nodeName.toLowerCase(),n=s.find("question"),o=SBPLUS.getTextContent(n),l="",u=""
;switch(SBPLUS.isEmpty(n.attr("image"))||(l=SBPLUS.noScript(n.attr("image").trim())),SBPLUS.isEmpty(n.attr("audio"))||(u=SBPLUS.noScript(n.attr("audio").trim())),a.quiz={id:r,type:i,question:o,questionImg:l,questionAudio:u,stuAnswer:"",correct:!1},a.quizContainer=SBPLUS.layout.quizContainer,i){case"multiplechoicesingle":var d=$(s).find("choices").find("answer");if(!SBPLUS.isEmpty($(s).find("choices").attr("random"))){var c=SBPLUS.noScript($(s).find("choices").attr("random").trim().toLowerCase());a.quiz.random="yes"===c||"true"===c}a.quiz.answers=[],$.each(d,(function(){var e={};e.value=SBPLUS.noScript($(this).find("value").text().trim()),SBPLUS.isEmpty($(this).attr("image"))||(e.img=SBPLUS.noScript($(this).attr("image").trim()),e.value=e.img),SBPLUS.isEmpty($(this).attr("audio"))||(e.audio=SBPLUS.noScript($(this).attr("audio").trim()),e.value=e.audio),SBPLUS.isEmpty($(this).attr("correct"))||"yes"!==$(this).attr("correct").toLowerCase()&&"true"!==$(this).attr("correct").toLowerCase()||(e.correct=SBPLUS.noScript($(this).attr("correct").trim().toLowerCase()));var t=$(this).find("feedback");t.length&&(e.feedback=SBPLUS.getTextContent(t)),a.quiz.answers.push(e)}));break;case"multiplechoicemultiple":var p=$(s).find("choices").find("answer");if(!SBPLUS.isEmpty($(s).find("choices").attr("random"))){var m=SBPLUS.noScript($(s).find("choices").attr("random").trim().toLowerCase());a.quiz.random="yes"===m||"true"===m}a.quiz.answers=[],$.each(p,(function(){var e={};e.value=SBPLUS.noScript($(this).find("value").text().trim()),SBPLUS.isEmpty($(this).attr("image"))||(e.img=SBPLUS.noScript($(this).attr("image").trim()),e.value=e.img),SBPLUS.isEmpty($(this).attr("audio"))||(e.audio=SBPLUS.noScript($(this).attr("audio").trim()),e.value=e.audio),SBPLUS.isEmpty($(this).attr("correct"))||"yes"!==$(this).attr("correct").toLowerCase()&&"true"!==$(this).attr("correct").toLowerCase()||(e.correct=SBPLUS.noScript($(this).attr("correct").trim().toLowerCase())),a.quiz.answers.push(e)}));var g=$(s).find("correctFeedback"),h=$(s).find("incorrectFeedback");g.length&&(a.quiz.correctFeedback=SBPLUS.getTextContent(g)),h.length&&(a.quiz.incorrectFeedback=SBPLUS.getTextContent(h));break;case"shortanswer":var b=$(s).find("feedback");b.length&&(a.quiz.feedback=SBPLUS.getTextContent(b));break;case"fillintheblank":var f=$(s).find("correctFeedback"),v=$(s).find("incorrectFeedback");f.length&&(a.quiz.correctFeedback=SBPLUS.getTextContent(f)),v.length&&(a.quiz.incorrectFeedback=SBPLUS.getTextContent(v)),a.quiz.answer=SBPLUS.noScript($(s).find("answer").text().trim());break}!1===questionExists(a.quiz.id)&&quizTracker.push(this.quiz)};Quiz.prototype.getQuiz=function(){var e=this,t=!1;e.qIndex=getCurrentQuizItem(quizTracker,e.quiz.id),Array.isArray(quizTracker[e.qIndex].stuAnswer)?quizTracker[e.qIndex].stuAnswer.length>=1&&(t=!0):SBPLUS.isEmpty(quizTracker[e.qIndex].stuAnswer)||(t=!0),t?e.renderFeeback():e.renderQuiz(),"on"!==SBPLUS.xml.settings.mathjax&&"true"!==SBPLUS.xml.settings.mathjax||MathJax.Hub.Queue(["Typeset",MathJax.Hub])},Quiz.prototype.renderQuiz=function(){var e=this,t="",a="",s='<div class="sbplus_quiz_header"><span class="icon-assessment"></span>';s+=" Self Assessment</div>",SBPLUS.isEmpty(e.quiz.questionImg)||(t='<p><img src="assets/images/'+e.quiz.questionImg+'" /></p>'),SBPLUS.isEmpty(e.quiz.questionAudio)||(a='<p><audio controls><source src="assets/audio/'+e.quiz.questionAudio+'" type="audio/mpeg" /></audio></p>'),s+='<div class="sbplus_quiz_question">'+t+a+e.quiz.question+"</div>",s+='<div class="sbplus_quiz_input"></div>',s+='<button class="sbplus_quiz_submit_btn">Submit</button>',$(e.quizContainer).html(s).promise().done((function(){switch(e.quiz.type){case"multiplechoicesingle":var t="";e.quiz.random&&shuffle(e.quiz.answers),$.each(e.quiz.answers,(function(a){var s=SBPLUS.sanitize(e.quiz.answers[a].value);return SBPLUS.isEmpty(e.quiz.answers[a].img)?SBPLUS.isEmpty(e.quiz.answers[a].audio)?void(t+='<label for="'+s+'"><input type="radio" id="'+s+'" name="ms" value="'+a+'" /> '+e.quiz.answers[a].value+"</label>"):(s=SBPLUS.sanitize(e.quiz.answers[a].audio),t+='<label class="au_val" for="'+s+'"><input type="radio" id="'+s+'" name="ms" value="'+a+'" /> <audio controls><source src="assets/audio/'+e.quiz.answers[a].audio+'" type="audio/mpeg"/></audio></label>',!0):(s=SBPLUS.sanitize(e.quiz.answers[a].img),t+='<label class="img_val" for="'+s+'"><input type="radio" id="'+s+'" name="ms" value="'+a+'" /><img src="assets/images/'+e.quiz.answers[a].img+'"/ ></label>',!0)})),$(".sbplus_quiz_input").html(t);break;case"multiplechoicemultiple":var a="";e.quiz.random&&shuffle(e.quiz.answers),$.each(e.quiz.answers,(function(t){var s=SBPLUS.sanitize(e.quiz.answers[t].value);return SBPLUS.isEmpty(e.quiz.answers[t].img)?SBPLUS.isEmpty(e.quiz.answers[t].audio)?void(a+='<label for="'+s+'"><input type="checkbox" id="'+s+'" name="mm" value="'+t+'" /> '+e.quiz.answers[t].value+"</label>"):(s=SBPLUS.sanitize(e.quiz.answers[t].audio),a+='<label class="au_val" for="'+s+'"><input type="checkbox" id="'+s+'" name="mm" value="'+t+'" /> <audio controls><source src="assets/audio/'+e.quiz.answers[t].audio+'" type="audio/mpeg"/></audio></label>',!0):(s=SBPLUS.sanitize(e.quiz.answers[t].img),a+='<label class="img_val" for="'+s+'"><input type="checkbox" id="'+s+'" name="mm" value="'+t+'" /><img src="assets/images/'+e.quiz.answers[t].img+'" /></label>',!0)})),$(".sbplus_quiz_input").html(a);break;case"shortanswer":$(".sbplus_quiz_input").html("<textarea></textarea>");break;case"fillintheblank":$(".sbplus_quiz_input").html('<input type="text" />');break}})),$("button.sbplus_quiz_submit_btn").on("click",(function(){switch(e.quiz.type){case"multiplechoicesingle":quizTracker[e.qIndex].stuAnswer=$('input[type="radio"]:checked').val(),SBPLUS.isEmpty(quizTracker[e.qIndex].stuAnswer)||$.each(e.quiz.answers,(function(){var t;if(void 0!==this.correct)return SBPLUS.sanitize(e.quiz.answers[Number(quizTracker[e.qIndex].stuAnswer)].value)===SBPLUS.sanitize(this.value)?quizTracker[e.qIndex].correct=!0:quizTracker[e.qIndex].correct=!1,!1}));break;case"multiplechoicemultiple":var t=$('input:checkbox[name="mm"]'),a=[];if(quizTracker[e.qIndex].stuAnswer=[],t.each((function(){this.checked&&quizTracker[e.qIndex].stuAnswer.push(Number($(this).val()))})),$.each(e.quiz.answers,(function(){void 0!==this.correct&&a.push(SBPLUS.sanitize(this.value))})),quizTracker[e.qIndex].stuAnswer.length<a.length||quizTracker[e.qIndex].stuAnswer.length>a.length)quizTracker[e.qIndex].correct=!1;else if(quizTracker[e.qIndex].stuAnswer.length===a.length)for(var s=0;s<quizTracker[e.qIndex].stuAnswer.length;s++){var r=Number(quizTracker[e.qIndex].stuAnswer[s]),i=SBPLUS.sanitize(quizTracker[e.qIndex].answers[r].value);if(!($.inArray(i,a)>=0)){quizTracker[e.qIndex].correct=!1;break}quizTracker[e.qIndex].correct=!0}break;case"shortanswer":quizTracker[e.qIndex].stuAnswer=$(".sbplus_quiz_input textarea").val();break;case"fillintheblank":quizTracker[e.qIndex].stuAnswer=$("input").val(),quizTracker[e.qIndex].stuAnswer!==e.quiz.answer?quizTracker[e.qIndex].correct=!1:quizTracker[e.qIndex].correct=!0;break}var n=!1;Array.isArray(quizTracker[e.qIndex].stuAnswer)?quizTracker[e.qIndex].stuAnswer.length>=1&&(n=!0):SBPLUS.isEmpty(quizTracker[e.qIndex].stuAnswer)||(n=!0),!1===n?($(".sbplus_quiz_header").after('<div class="quiz_error"><span class="icon-warning"></span> Please answer the question before submitting.</div>'),setTimeout((function(){$(".quiz_error").fadeOut(1e3,(function(){$(this).remove()}))}),4e3)):(e.renderFeeback(),"on"!==SBPLUS.xml.settings.mathjax&&"true"!==SBPLUS.xml.settings.mathjax||MathJax.Hub.Queue(["Typeset",MathJax.Hub]))}));var r=SBPLUS.getCourseDirectory()+":quiz:page"+SBPLUS.targetPage.data("count");SBPLUS.sendToGA("Quiz","completed",r,3,0)},Quiz.prototype.renderFeeback=function(){var e=this,t="",a="",s='<div class="sbplus_quiz_header"><span class="icon-assessment"></span>';switch(s+=" Self Assessment Feedback</div>","shortanswer"!==e.quiz.type&&(quizTracker[e.qIndex].correct?s+='<div class="quiz_correct"><span class="icon-check"></span> Correct!</div>':s+='<div class="quiz_incorrect"><span class="icon-warning"></span> Incorrect!</div>'),SBPLUS.isEmpty(e.quiz.questionImg)||(t='<p><img src="assets/images/'+e.quiz.questionImg+'" /></p>'),SBPLUS.isEmpty(e.quiz.questionAudio)||(a='<p><audio controls><source src="assets/audio/'+e.quiz.questionAudio+'" type="audio/mpeg" /></audio></p>'),s+='<div class="sbplus_quiz_question">'+t+a+e.quiz.question+"</div>",s+='<div class="sbplus_quiz_result">',e.quiz.type){case"shortanswer":s+="<p><strong>Your answer:</strong><br>"+quizTracker[e.qIndex].stuAnswer+"</p>",SBPLUS.isEmpty(e.quiz.feedback)||(s+="<p><strong>Feedback:</strong><br>"+e.quiz.feedback+"</p>");break;case"fillintheblank":s+="<p><strong>Your answer:</strong><br>"+quizTracker[e.qIndex].stuAnswer+"</p>",s+="<p><strong>Correct answer:</strong><br>"+e.quiz.answer+"</p>",quizTracker[e.qIndex].correct?SBPLUS.isEmpty(e.quiz.correctFeedback)||(s+="<p><strong>Feedback:</strong><br>"+e.quiz.correctFeedback+"</p>"):SBPLUS.isEmpty(e.quiz.incorrectFeedback)||(s+="<p><strong>Feedback:</strong><br>"+e.quiz.incorrectFeedback+"</p>");break;case"multiplechoicesingle":var r=Number(quizTracker[e.qIndex].stuAnswer),i=quizTracker[e.qIndex].answers[r],n=i.value,o=i.feedback,l=i.img,u=i.audio,d="text";switch(SBPLUS.isEmpty(l)||(d="img"),SBPLUS.isEmpty(u)||(d="audio"),d){case"img":s+='<p><strong>Your answer:</strong><br><img src="assets/images/'+i.img+'" /></p>';break;case"audio":s+='<p><strong>Your answer:</strong><br><audio controls><source src="assets/audio/'+u+'" type="audio/mpeg"/></audio></p>';break;case"text":s+="<p><strong>Your answer:</strong><br>"+n+"</p>";break}$.each(e.quiz.answers,(function(t){if(void 0!==e.quiz.answers[t].correct){var a=e.quiz.answers[t].value;switch(d){case"img":a='<img src="assets/images/'+e.quiz.answers[t].value+'" />';break;case"audio":a='<audio controls><source src="assets/audio/'+e.quiz.answers[t].value+'" type="audio/mpeg"/></audio>';break}return s+="<p><strong>Correct answer:</strong><br>"+a+"</p>",!1}})),SBPLUS.isEmpty(o)||(s+="<p><strong>Feedback:</strong><br>"+o+"</p>");break;case"multiplechoicemultiple":var c=quizTracker[e.qIndex].stuAnswer;s+="<p><strong>Your answer:</strong><br>",$.each(c,(function(t){var a=Number(c[t]),r="text";switch(SBPLUS.isEmpty(e.quiz.answers[a].img)||(r="img"),SBPLUS.isEmpty(e.quiz.answers[a].audio)||(r="audio"),r){case"img":s+='<img src="assets/images/'+e.quiz.answers[a].value+'" /><br>';break;case"audio":s+='<audio controls><source src="assets/audio/'+e.quiz.answers[a].value+'" type="audio/mpeg"/></audio><br>';break;case"text":s+=e.quiz.answers[a].value+"<br>";break}})),s+="</p><p><strong>Correct answer:</strong><br>",$.each(e.quiz.answers,(function(){if(void 0!==this.correct){var e="text";switch(SBPLUS.isEmpty(this.img)||(e="img"),SBPLUS.isEmpty(this.audio)||(e="audio"),e){case"img":s+='<img src="assets/images/'+this.value+'" /><br>';break;case"audio":s+='<audio controls><source src="assets/audio/'+this.value+'" type="audio/mpeg"/></audio><br>';break;case"text":s+=this.value+"<br>";break}}})),s+="</p>",quizTracker[e.qIndex].correct?SBPLUS.isEmpty(e.quiz.correctFeedback)||(s+="<p><strong>Feedback:</strong><br>"+e.quiz.correctFeedback+"</p>"):SBPLUS.isEmpty(e.quiz.incorrectFeedback)||(s+="<p><strong>Feedback:</strong><br>"+e.quiz.incorrectFeedback+"</p>");break}s+="</div>",$(e.quizContainer).html(s)},MenuBar.prototype.bindHandlers=function(){var e=this;e.items.on("mouseenter",(function(){return $(this).addClass("menu-hover"),!0})),e.items.on("mouseout",(function(){return $(this).removeClass("menu-hover"),!0})),e.allItems.on("click",(function(t){e.handleClick($(this),t)})),e.allItems.on("keydown",(function(t){return e.handleKeydown($(this),t)})),e.allItems.on("keypress",(function(t){return e.handleKeypress($(this),t)})),e.allItems.on("focus",(function(t){return e.handleFocus($(this),t)})),e.allItems.on("blur",(function(t){return e.handleBlur($(this),t)})),$(document).on("click",(function(t){return e.handleDocumentClick(t)}))},MenuBar.prototype.handleClick=function(e,t){var a=this,s;if(e.parent().is(".root-level")){var r=e.children("ul").first();"false"===r.attr("aria-hidden")?(e.attr("aria-expanded","false"),r.attr({"aria-hidden":"true","aria-expanded":"false"}),r.parent().removeClass("active")):(e.attr("aria-expanded","true"),r.attr({"aria-hidden":"false","aria-expanded":"true"}),r.parent().addClass("active"))}else a.allItems.removeClass("menu-hover menu-focus"),e.attr("aria-expanded","false"),a.id.find("ul").not(".root-level").attr({"aria-hidden":"true","aria-expanded":"false"});return t.stopPropagation(),!1},MenuBar.prototype.handleFocus=function(e){var t=this;if(null===this.activeItem)this.activeItem=e;else if(e[0]!==t.activeItem[0])return!0;var a=t.activeItem.parentsUntil("div").filter("li"),s;(t.allItems.removeClass("menu-focus"),t.activeItem.addClass("menu-focus"),a.addClass("menu-focus"),!0===t.isVerticalMenu)&&(!0===t.bChildOpen?e.parent().is(".root-level")&&"true"===e.attr("aria-haspopup")&&(e.attr("aria-expanded","true"),e.children("ul").attr({"aria-hidden":"false","aria-expanded":"true"})):t.isVerticalMenu=!1);return!0},MenuBar.prototype.handleBlur=function(e){return e.removeClass("menu-focus"),!0},MenuBar.prototype.handleKeydown=function(e,t){var a=this;if(t.altKey||t.ctrlKey)return!0;var s=e.parent();switch(t.keyCode){case a.keys.tab:e.attr("aria-expanded","false"),a.id.find("ul").attr({"aria-hidden":"true","aria-expanded":"false"}),a.allItems.removeClass("menu-focus"),a.activeItem=null,a.bChildOpen=!1;break;case a.keys.esc:return e.attr("aria-expanded","false"),s.is(".root-level")?e.children("ul").first().attr({"aria-hidden":"true","aria-expanded":"false"}):(a.activeItem=s.parent(),a.bChildOpen=!1,a.activeItem.focus(),s.attr({"aria-hidden":"true","aria-expanded":"false"})),t.stopPropagation(),!1;case a.keys.enter:case a.keys.space:var r;if(e.parent().is(".root-level"))e.children("ul").first().attr({"aria-hidden":"false","aria-expanded":"true"});else{a.allItems.removeClass("menu-hover menu-focus"),a.id.find("ul").not(".root-level").attr({"aria-hidden":"true","aria-expanded":"false"});var i=a.activeItem.find("a").attr("id");document.getElementById(i).click(),a.activeItem=null}return t.stopPropagation(),!1;case a.keys.left:return!0===a.isVerticalMenu&&s.is(".root-level")?a.activeItem=a.moveUp(e):a.activeItem=a.moveToPrevious(e),a.activeItem.focus(),t.stopPropagation(),!1;case a.keys.right:return!0===a.isVerticalMenu&&s.is(".root-level")?a.activeItem=a.moveDown(e):a.activeItem=a.moveToNext(e),a.activeItem.focus(),t.stopPropagation(),!1;case a.keys.up:return!0===a.isVerticalMenu&&s.is(".root-level")?a.activeItem=a.moveToPrevious(e):a.activeItem=a.moveUp(e),a.activeItem.focus(),t.stopPropagation(),!1;case a.keys.down:return!0===a.isVerticalMenu&&s.is(".root-level")?a.activeItem=a.moveToNext(e):a.activeItem=a.moveDown(e),a.activeItem.focus(),t.stopPropagation(),!1}return!0},MenuBar.prototype.moveToNext=function(e){var t=this,a=e.parent(),s=a.children("li"),r=s.length,i=s.index(e),n=null,o=null;if(a.is(".root-level"))n=i<r-1?e.next():s.first(),"true"===e.attr("aria-haspopup")&&"false"===(o=e.children("ul").first()).attr("aria-hidden")&&(e.attr("aria-expanded","false"),o.attr({"aria-hidden":"true","aria-expanded":"false"}),t.bChildOpen=!0),e.removeClass("menu-focus"),"true"===n.attr("aria-haspopup")&&!0===t.bChildOpen&&(o=n.children("ul").first(),e.attr("aria-expanded","true"),o.attr({"aria-hidden":"false","aria-expanded":"true"}));else if("true"===e.attr("aria-haspopup"))n=(o=e.children("ul").first()).children("li").first(),e.attr("aria-expanded","true"),o.attr({"aria-hidden":"false","aria-expanded":"true"});else{if(!0===t.isVerticalMenu)return e;var l=null,u=null;l=e.parentsUntil("div").filter("ul").not(".root-level"),e.attr("aria-expanded","false"),l.attr({"aria-hidden":"true","aria-expanded":"false"}),l.find("li").removeClass("menu-focus"),l.last().parent().removeClass("menu-focus"),u=l.last().parent(),(n=(i=t.rootItems.index(u))<t.rootItems.length-1?u.next():t.rootItems.first()).addClass("menu-focus"),"true"===n.attr("aria-haspopup")&&(o=n.children("ul").first(),n=o.children("li").first(),e.attr("aria-expanded","true"),o.attr({"aria-hidden":"false","aria-expanded":"true"}),t.bChildOpen=!0)}return n},MenuBar.prototype.moveToPrevious=function(e){var t=this,a=e.parent(),s=a.children("li"),r=s.index(e),i=null,n=null;if(a.is(".root-level"))i=r>0?e.prev():s.last(),"true"===e.attr("aria-haspopup")&&"false"===(n=e.children("ul").first()).attr("aria-hidden")&&(e.attr("aria-expanded","false"),n.attr({"aria-hidden":"true","aria-expanded":"false"}),t.bChildOpen=!0),e.removeClass("menu-focus"),"true"===i.attr("aria-haspopup")&&!0===t.bChildOpen&&(n=i.children("ul").first(),e.attr("aria-expanded","true"),n.attr({"aria-hidden":"false","aria-expanded":"true"}));else{var o=a.parent(),l=o.parent();!0!==t.isVerticalMenu&&l.is(".root-level")?(e.attr("aria-expanded","false"),a.attr({"aria-hidden":"true","aria-expanded":"false"}),e.removeClass("menu-focus"),o.removeClass("menu-focus"),(i=(r=this.rootItems.index(o))>0?o.prev():t.rootItems.last()).addClass("menu-focus"),"true"===i.attr("aria-haspopup")&&(n=i.children("ul").first(),e.attr("aria-expanded","true"),n.attr({"aria-hidden":"false","aria-expanded":"true"}),t.bChildOpen=!0,i=n.children("li").first())):(i=a.parent(),e.attr("aria-expanded","false"),a.attr({"aria-hidden":"true","aria-expanded":"false"}),e.removeClass("menu-focus"),!0===t.isVerticalMenu&&(t.bChildOpen=!1))}return i},MenuBar.prototype.moveDown=function(e,t){var a=e.parent(),s=a.children("li").not(".separator"),r=s.length,i=s.index(e),n=null,o=null;if(a.is(".root-level"))return"true"!==e.attr("aria-haspopup")?e:(n=(o=e.children("ul").first()).children("li").first(),$(o.parent()).attr("aria-expanded","true"),e.attr("aria-expanded","true"),o.attr({"aria-hidden":"false","aria-expanded":"true"}),n);if(t){var l=!1,u=i+1;for(u===r&&(u=0);u!==i;){var d;if(s.eq(u).html().charAt(0).toLowerCase()===t){l=!0;break}(u+=1)===r&&(u=0)}return!0===l?(n=s.eq(u),e.removeClass("menu-focus"),n):e}return n=i<r-1?s.eq(i+1):s.first(),e.removeClass("menu-focus"),n},MenuBar.prototype.moveUp=function(e){var t=e.parent(),a=t.children("li").not(".separator"),s=a.index(e),r=null;return t.is(".root-level")?e:(r=s>0?a.eq(s-1):a.last(),e.removeClass("menu-focus"),r)},MenuBar.prototype.handleKeypress=function(e,t){var a=this;if(t.altKey||t.ctrlKey||t.shiftKey)return!0;switch(t.keyCode){case a.keys.tab:return!0;case a.keys.esc:case a.keys.up:case a.keys.down:case a.keys.left:case a.keys.right:return t.stopPropagation(),!1;default:var s=String.fromCharCode(t.which);return a.activeItem=a.moveDown(e,s),a.activeItem.focus(),t.stopPropagation(),!1}},MenuBar.prototype.handleDocumentClick=function(){var e=this,t;return e.id.find("ul").not(".root-level").attr({"aria-hidden":"true","aria-expanded":"false"}),e.allItems.removeClass("menu-focus"),e.allItems.removeClass("active"),e.activeItem=null,!0};